webpackJsonp([10],{IGic:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("rx7x"),i=n("TIfe"),s={data:function(){var t=this,e=function(e,n,a){t.hasFmt?a():a(new Error("请上传封面图"))};return{hasFmt:!1,fileList:[],baceUrl:"",search_info:"",imgFullSrc:"",btnTable:a.btnTable,dialogVisible:!1,loading:!1,upData:[],params:{},per_page:10,total_pages:0,currentPage:1,banner_data:[],bannerDialog:!1,banner1:!1,dialogVisible2:!1,dialogImageUrl:"",uploadData:{},bannerForm:{},bannerForm1:{},editStatus:"2",bannerRules:{titleShort:[{required:!0,message:"请输入短标题",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字",trigger:"blur"}],icon:[{required:!0,validator:e,trigger:"change"}]},bannerRules1:{titleShort:[{required:!0,message:"请输入短标题",trigger:"blur"}],icon:[{required:!0,validator:e,trigger:"change"}]}}},computed:{upDataLength:function(){return this.upData.length-1}},created:function(){this.baceUrl=Object(i.a)(),this.initParams(),this.getBannerlist()},methods:{toBanner:function(){var t=this;this.$refs.bannerForm.validate(function(e){if(e){var n=new FormData;n.append("tokenId",t.$store.state.user.tokenId),n.append("titleShort",t.bannerForm.titleShort),n.append("bannerType",t.bannerForm.bannerType),n.append("linkId",t.bannerForm.linkId),n.append("articleId",t.bannerForm.articleId),n.append("editStatus",t.editStatus),n.append("id",t.bannerForm.id),"1"==t.editStatus&&n.append("file",t.bannerForm.newsFile,t.bannerForm.filename),t.$post("bannerInfo/save",n).then(function(e){console.log(e),0==e.code?(t.bannerDialog=!1,t.$message({message:e.msg,type:"success"}),t.getBannerlist()):t.$message({message:"对不起,修改失败",type:"error"})})}})},bannerEdit:function(t,e){var n=this;this.fileList=[],this.hasFmt=!0,this.bannerDialog=!0;var a={tokenId:this.$store.state.user.tokenId,id:e.id};this.$get("bannerInfo/show",a).then(function(t){n.bannerForm=t.data[0],n.imgSrc=n.bannerForm.coverImgId,n.imgFullSrc=n.bannerForm.coverImgUrl,n.fileList.push({url:n.imgFullSrc})})},top_flag1:function(t,e){var n=this;this.banner1=!1,this.$confirm("确定要下线吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={tokenId:n.$store.state.user.tokenId,id:e.id,status:"2"};n.$post("bannerInfo/isOnline",t).then(function(t){n.$message({type:"success",message:"下线成功!"}),setTimeout(function(){n.getBannerlist()},1e3)})}).catch(function(){n.$message({type:"info",message:"下线失败"})})},top_flag2:function(t,e){var n=this;this.banner1=!1,"5"!=e.originalStatus?"1"!=e.topFlag?this.$confirm("确定上线吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={tokenId:n.$store.state.user.tokenId,id:e.id,status:"1"};n.$post("bannerInfo/isOnline",t).then(function(t){0==t.code?n.$message({type:"success",message:"上线成功!"}):n.$message({type:"warning",message:t.msg}),n.getBannerlist()})}).catch(function(){n.$message({type:"info",message:"上线失败"})}):this.$message({type:"warning",message:"相关新闻已经置顶,无法上线到banner!"}):this.$message({type:"warning",message:"相关新闻已经下线,无法上线到banner!"})},bannerShow:function(t,e){var n=this;this.banner1=!0,this.fileList=[];var a={tokenId:this.$store.state.user.tokenId,id:e.id};this.$get("bannerInfo/show",a).then(function(t){console.log(t.data[0]),n.bannerForm1=t.data[0],"0"==n.bannerForm1.status?n.bannerForm1.statusText="待上线":"1"==n.bannerForm1.status?n.bannerForm1.statusText="已上线":n.bannerForm1.statusText="已下线线",n.imgSrc=n.bannerForm1.coverImgId,n.imgFullSrc=n.bannerForm1.coverImgUrl,console.log(n.imgFullSrc)})},handleRemove:function(t,e){0==e.length&&(this.hasFmt=!1,this.editStatus="1")},handlePictureCardPreview:function(t){console.log(t),this.dialogImageUrl=t.url},getFullUrl:function(){return this.baceUrl+"/bannerInfo/save"},publishWaitTop:function(){var t=this;this.dialogVisible=!0,this.loading=!0,this.$get("bannerInfo/getIsOnline",{tokenId:this.$store.state.user.tokenId}).then(function(e){t.loading=!1,console.log(e),t.upData=e.data})},toPublish1:function(){var t=this,e=[];this.upData.map(function(t,n){e.push(t.id)});var n={tokenId:this.$store.state.user.tokenId,ids:e.join(",")};console.log(n),this.$post("bannerInfo/publishIsOnline",n).then(function(e){"0"==e.code?(t.$message({type:"success",message:e.msg}),t.dialogVisible=!1):t.$message({type:"error",message:e.msg?e.msg:"发布失败"})})},toPublish:function(){var t=this,e={tokenId:this.$store.state.user.tokenId};this.upData.map(function(t,n){e["bannerInfos["+n+"].id"]=t.id,e["bannerInfos["+n+"].orderNum"]=n+1}),console.log(e),this.$post("bannerInfo/publishIsOnline",e).then(function(e){"0"==e.code?(t.$message({type:"success",message:e.msg}),t.dialogVisible=!1):t.$message({type:"error",message:e.msg?e.msg:"发布失败"})})},getBannerlist:function(t){var e=this;if(!t)t={tokenId:this.$store.state.user.tokenId,limit:this.per_page,offset:this.currentPage,simpleParameter:this.search_info};console.log(t),this.$post("bannerInfo/list",t).then(function(t){e.banner_data=t.data[0].rows,e.total_pages=t.data[0].total}),this.search_info=""},getBannerlist1:function(t){var e=this;if(!t)t={tokenId:this.$store.state.user.tokenId,limit:this.per_page,offset:this.currentPage};this.$post("bannerInfo/list",t).then(function(t){console.log(t.data[0].rows),e.banner_data=t.data[0].rows,e.total_pages=t.data[0].total}),this.banner1=!1},initParams:function(){this.params={tokenId:this.$store.state.user.tokenId,limit:this.per_page,offset:this.currentPage}},handleSizeChange:function(t){this.per_page=t,this.getBannerlist()},handleCurrentChange:function(t){this.currentPage=t,this.initParams(),console.log(this.params),this.getBannerlist(this.params)},deleteRow:function(t,e){var n=this;this.$confirm("此操作将永久删除该新闻, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={tokenId:n.$store.state.user.tokenId,id:e.id};n.$post("/bannerInfo/delete",t).then(function(t){n.$message({type:"success",message:"删除成功!"}),n.getBannerlist()})}).catch(function(){n.$message({type:"info",message:"已取消删除"})}),console.log(t,e)},fileChange:function(t,e){this.$refs.icon.clearValidate(),this.bannerForm.filename=t.name,this.bannerForm.newsFile=t.raw,e.length>0&&(this.hasFmt=!0)},handleExceed:function(t,e){this.$message.warning("当前限制选择 1 个文件")},changeIndex:function(t,e,n){if("isUp"==n){var a=e[t],i=e[t-1];e.splice(t-1,1,a),e.splice(t,1,i)}else{a=e[t],i=e[t+1];e.splice(t+1,1,a),e.splice(t,1,i)}},handleClose:function(t){this.$confirm("确认关闭？").then(function(e){t()}).catch(function(t){})},sort:function(){var t=[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6}],e=t[2];t[2]=t[3],t[3]=e,console.log(t)}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-body banner"},[n("el-dialog",{attrs:{center:"",title:"设置置顶内容排序",visible:t.dialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.upData,border:"","row-class-name":t.btnTable,"header-row-class-name":t.btnTable}},[n("el-table-column",{attrs:{prop:"titleShort",label:"标题"}}),t._v(" "),n("el-table-column",{staticClass:"text-center",attrs:{prop:"name",label:"操作",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?n("el-button",{attrs:{type:"text"},on:{click:function(n){t.changeIndex(e.$index,t.upData,"isUp")}}},[n("i",{staticClass:"iconfont icon-up"})]):n("el-button",{attrs:{type:"text",disabled:""}},[n("i",{staticClass:"iconfont icon-up unclick"})]),t._v(" "),e.$index!=t.upDataLength?n("el-button",{attrs:{type:"text"},on:{click:function(n){t.changeIndex(e.$index,t.upData,"isDown")}}},[n("i",{staticClass:"iconfont icon-down"})]):n("el-button",{attrs:{type:"text",disabled:""}},[n("i",{staticClass:"iconfont icon-down",staticStyle:{cursor:"not-allowed"}})])]}}])})],1),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.toPublish()}}},[t._v("发 布")])],1)],1),t._v(" "),n("el-dialog",{attrs:{center:"",width:"30%",visible:t.bannerDialog,"append-to-body":""},on:{"update:visible":function(e){t.bannerDialog=e}}},[n("el-form",{ref:"bannerForm",staticClass:"bannerForm",attrs:{model:t.bannerForm,rules:t.bannerRules,"label-width":"110px"}},[n("el-form-item",{attrs:{label:"原文标题"}},[n("el-input",{attrs:{size:"mini",disabled:!0},model:{value:t.bannerForm.titleOriginal,callback:function(e){t.$set(t.bannerForm,"titleOriginal",e)},expression:"bannerForm.titleOriginal"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"短标题",prop:"titleShort"}},[n("el-input",{attrs:{size:"mini"},model:{value:t.bannerForm.titleShort,callback:function(e){t.$set(t.bannerForm,"titleShort",e)},expression:"bannerForm.titleShort"}})],1),t._v(" "),n("el-form-item",{ref:"icon",attrs:{label:"banner图片","label-width":"110px",prop:"icon"}},[n("el-upload",{ref:"upload",attrs:{action:"",multiple:!1,limit:1,name:"file","file-list":t.fileList,"list-type":"picture-card","auto-upload":!1,"on-change":t.fileChange,"on-exceed":t.handleExceed,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[n("i",{staticClass:"el-icon-plus"})]),t._v(" "),n("el-dialog",{attrs:{visible:t.dialogVisible2},on:{"update:visible":function(e){t.dialogVisible2=e}}},[n("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),n("el-form-item",{attrs:{label:"类型"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==t.bannerForm.bannerType?n("el-input",{attrs:{size:"mini",value:"新闻",disabled:""}}):t._e(),t._v(" "),"2"==t.bannerForm.bannerType?n("el-input",{attrs:{size:"mini",value:"专题",disabled:""}}):t._e()]}}])}),t._v(" "),n("el-form-item",{attrs:{label:"链接"}},[n("el-input",{attrs:{size:"mini",disabled:!0},model:{value:t.bannerForm.articleId,callback:function(e){t.$set(t.bannerForm,"articleId",e)},expression:"bannerForm.articleId"}})],1)],1),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{staticClass:"light_btn",on:{click:function(e){t.bannerDialog=!1,t.recommendRadio=""}}},[t._v("取 消")]),t._v(" "),n("el-button",{staticClass:"light_btn",attrs:{type:"primary"},nativeOn:{click:function(e){e.preventDefault(),t.toBanner()}}},[t._v("保 存")])],1)],1),t._v(" "),n("el-dialog",{staticStyle:{"z-index":"99999"},attrs:{center:"",width:"30%",visible:t.banner1},on:{"update:visible":function(e){t.banner1=e}}},[n("el-form",{ref:"bannerForm1",staticClass:"bannerForm1",attrs:{data:t.bannerForm1,rules:t.bannerRules1,"label-width":"110px"}},[n("el-form-item",{attrs:{label:"原文标题"}},[n("el-input",{attrs:{size:"mini",type:"textarea",disabled:!0},model:{value:t.bannerForm1.titleOriginal,callback:function(e){t.$set(t.bannerForm1,"titleOriginal",e)},expression:"bannerForm1.titleOriginal"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"短标题",prop:"titleShort"}},[n("el-input",{attrs:{size:"mini",disabled:!0},model:{value:t.bannerForm1.titleShort,callback:function(e){t.$set(t.bannerForm1,"titleShort",e)},expression:"bannerForm1.titleShort"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"banner图片"}},[n("img",{staticClass:"imgs",staticStyle:{width:"80px","max-height":"80px"},attrs:{src:t.imgFullSrc,alt:"封面图展示"}})]),t._v(" "),n("el-form-item",{attrs:{label:"类型"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==t.bannerForm1.bannerType?n("el-input",{attrs:{size:"mini",value:"新闻",disabled:""}}):t._e(),t._v(" "),"2"==t.bannerForm1.bannerType?n("el-input",{attrs:{size:"mini",value:"专题",disabled:""}}):t._e()]}}])}),t._v(" "),n("el-form-item",{attrs:{label:"链接"}},[n("el-input",{attrs:{size:"mini",disabled:!0},model:{value:t.bannerForm1.articleId,callback:function(e){t.$set(t.bannerForm1,"articleId",e)},expression:"bannerForm1.articleId"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"其他信息"}},[n("el-input",{attrs:{size:"mini",disabled:!0},model:{value:t.bannerForm1.statusText,callback:function(e){t.$set(t.bannerForm1,"statusText",e)},expression:"bannerForm1.statusText"}},[n("template",{slot:"prepend"},[t._v("状态")])],2)],1)],1),t._v(" "),n("table",{staticClass:"el-table el-table__body el-table--border marT20",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[n("colgroup",[n("col",{attrs:{name:"el-table_1_column_1",width:"25%"}}),t._v(" "),n("col",{attrs:{name:"el-table_1_column_1",width:"50%"}}),t._v(" "),n("col",{attrs:{name:"el-table_1_column_1",width:"25%"}})]),t._v(" "),n("tbody",[n("tr",{staticClass:"el-table__row"},[n("td",[n("div",{staticClass:"cell"})]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v("时间")])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v("操作账号")])])]),t._v(" "),n("tr",{staticClass:"el-table__row"},[n("td",[n("div",{staticClass:"cell"},[t._v("创建时间")])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.createTime))])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.createUser))])])]),t._v(" "),n("tr",{staticClass:"el-table__row"},[n("td",[n("div",{staticClass:"cell"},[t._v("上线时间")])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.onlineTime))])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.onlineUser))])])]),t._v(" "),n("tr",{staticClass:"el-table__row"},[n("td",[n("div",{staticClass:"cell"},[t._v("下线时间")])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.offlineTime))])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.offlineUser))])])]),t._v(" "),n("tr",{staticClass:"el-table__row"},[n("td",[n("div",{staticClass:"cell"},[t._v("修改时间")])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.updateTime))])]),t._v(" "),n("td",[n("div",{staticClass:"cell"},[t._v(t._s(t.bannerForm1.updateUser))])])])])])],1),t._v(" "),n("div",{staticClass:"page-header clearfix"},[n("el-input",{staticStyle:{width:"220px",margin:"0 20px"},attrs:{size:"mini",placeholder:"请输入内容"},model:{value:t.search_info,callback:function(e){t.search_info=e},expression:"search_info"}}),t._v(" "),n("el-button",{staticClass:"light_btn",attrs:{size:"mini"},nativeOn:{click:function(e){e.preventDefault(),t.getBannerlist()}}},[t._v("搜索")])],1),t._v(" "),n("div",{staticClass:"box"},[n("div",{staticStyle:{"text-align":"right","margin-bottom":"4px"}},[n("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:function(e){t.publishWaitTop()}}},[t._v("发布")]),t._v(" "),n("el-button",{staticClass:"light_btn",attrs:{size:"mini"},nativeOn:{click:function(e){e.preventDefault(),t.getBannerlist()}}},[t._v("刷新")])],1),t._v(" "),n("div",{staticClass:"banner_show"},[n("el-table",{attrs:{data:t.banner_data,border:"",stripe:"","row-class-name":t.btnTable,"header-row-class-name":t.btnTable}},[n("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),t._v(" "),n("el-table-column",{attrs:{label:"原文标题"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.banner_type||"3"==e.row.banner_type?n("p",[t._v(t._s(e.row.title_original))]):t._e(),t._v(" "),"2"==e.row.banner_type?n("p",[t._v(t._s(e.row.title_original1))]):t._e()]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"短标语",prop:"title_short",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{label:"发布状态",prop:"status",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.status?n("p",{staticClass:"yshx"},[t._v("已上线")]):t._e(),t._v(" "),"0"==e.row.status?n("p",{staticClass:"dshx"},[t._v("待上线")]):t._e(),t._v(" "),"2"==e.row.status?n("p",{staticClass:"yxx"},[t._v("已下线")]):t._e()]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"内容类型",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.banner_type?n("p",[t._v("新闻")]):t._e(),t._v(" "),"2"==e.row.banner_type?n("p",[t._v("专题")]):t._e(),t._v(" "),"3"==e.row.banner_type?n("p",[t._v("行情")]):t._e()]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"图片",width:"100"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("img",{attrs:{src:t.row.coverImgUrl,alt:""}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"上线时间",prop:"online_time",width:"100"}}),t._v(" "),n("el-table-column",{attrs:{label:"创建时间",prop:"create_time",width:"100"}}),t._v(" "),n("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.status?n("el-button",{staticStyle:{"margin-right":"8px","vertical-align":"middle"},attrs:{type:"text"},nativeOn:{click:function(n){n.preventDefault(),t.top_flag1(e.$index,e.row)}}},[t._v("下线")]):n("el-button",{staticStyle:{"margin-right":"8px","vertical-align":"middle"},attrs:{type:"text",disabled:""}},[t._v("下线")]),t._v(" "),"2"==e.row.status||"0"==e.row.status?n("el-button",{staticStyle:{"margin-right":"8px","vertical-align":"middle"},attrs:{type:"text"},nativeOn:{click:function(n){n.preventDefault(),t.top_flag2(e.$index,e.row)}}},[t._v("上线")]):t._e(),t._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(n){t.bannerShow(e.$index,e.row)}}},[n("i",{staticClass:"iconfont icon-see"})]),t._v(" "),"1"==e.row.status?n("el-button",{attrs:{type:"text",disabled:!0}},[n("i",{staticClass:"iconfont icon-edit"})]):t._e(),t._v(" "),"2"==e.row.status||"0"==e.row.status?n("el-button",{attrs:{type:"text"},nativeOn:{click:function(n){n.preventDefault(),t.bannerEdit(e.$index,e.row)}}},[n("i",{staticClass:"iconfont icon-edit"})]):t._e(),t._v(" "),"1"==e.row.status?n("el-button",{attrs:{type:"text",disabled:!0},nativeOn:{click:function(n){n.preventDefault(),t.deleteRow(e.$index,e.row)}}},[n("i",{staticClass:"iconfont icon-delete"})]):t._e(),t._v(" "),"2"==e.row.status||"0"==e.row.status?n("el-button",{attrs:{type:"text"},nativeOn:{click:function(n){n.preventDefault(),t.deleteRow(e.$index,e.row)}}},[n("i",{staticClass:"iconfont icon-delete"})]):t._e()]}}])})],1),t._v(" "),n("div",{staticClass:"marT20"},[n("el-pagination",{staticClass:"text-right",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)])],1)},staticRenderFns:[]};var r=n("VU/8")(s,l,!1,function(t){n("jsw1")},null,null);e.default=r.exports},jsw1:function(t,e){}});
//# sourceMappingURL=10.e5e3f983178018942012.js.map