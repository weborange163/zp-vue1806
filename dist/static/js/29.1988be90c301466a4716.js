webpackJsonp([29],{NVvI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={data:function(){var e=this;return{filterCode:"",newDialog:!1,newDialog1:!1,imgDialog:!1,loading2:!1,plat:"1",dialogImageUrl:"",bagForm:{radio:"0"},bagRules:{icon:[{required:!0,validator:function(t,a,o){e.hasFmt?o():o(new Error("请上传安装包"))},trigger:"change"}],num:[{required:!0,message:"请输入版本号",trigger:"blur"},{pattern:/^[a-zA-Z0-9.]+$/,message:"只允许输入英文数字和.",trigger:"blur"}],bagcode:[{required:!0,message:"请输入code版本",trigger:"blur"},{pattern:/^[0-9]*$/,message:"code版本只能输入数字",trigger:"blur"}],bagname:[{required:!0,message:"请输入应用报名",trigger:"blur"},{pattern:/^[a-zA-Z0-9.]+$/,message:"只允许输入英文数字和.",trigger:"blur"}],desc:[{required:!0,message:"请输入code版本",trigger:"blur"}]},fileList:[],hasFmt:!1,versionData:[],loading:!1,multipleSelection:[],newArticle:[{num:1,title:"test7mkaiemlaoapuemske93osksks",author:"web"}],activeTab:"first",recommendRadio:1,dialogVisible:!1,dialogVisible1:!1,per_page:10,total_pages:0,currentPage:1,source:"",isEdit:!1,sources:[{value:"0",label:"全部"},{value:"2",label:"iOS"},{value:"1",label:"Adroid"}]}},created:function(){this.getList()},methods:{downBag:function(e){var t=this;this.$confirm("确定要下载此应用包吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){window.location.href=e}).catch(function(){t.$message({type:"info",message:"已取消下载"})})},selectChange:function(e){console.log(e),"2"==e&&this.$refs.icon.clearValidate(),this.$refs.bagForm.resetFields()},editBag:function(e){console.log(e),this.newDialog=!0,this.plat=e.platform_type,this.fileList.push({url:e.download_url,name:e.file_name}),this.bagForm.url=e.download_url,this.bagForm.num=e.version_name,this.bagForm.bagcode=e.version_code,this.bagForm.bagname=e.package_name,this.bagForm.desc=e.upgrade_content,this.bagForm.radio=e.upgrade_mode,this.hasFmt=!0,this.editId=e.id,this.isEdit=!0},createBag:function(){var e=this;this.$refs.bagForm.validate(function(t){if(console.log(t),"2"==e.plat&&e.bagForm.num&&e.bagForm.bagcode&&e.bagForm.bagname&&e.bagForm.desc&&console.log(111),t){e.loading2=!0,console.log(t);var a=new FormData;a.append("tokenId",e.$store.state.user.tokenId),a.append("appType",1),a.append("platformType",e.plat),a.append("versionName",e.bagForm.num),a.append("versionCode",e.bagForm.bagcode),a.append("packageName",e.bagForm.bagname),a.append("upgradeContent",e.bagForm.desc),a.append("upgradeMode",e.bagForm.radio),a.append("status","1"),"1"==e.plat?a.append("newsFile",e.bagForm.file,e.bagForm.filename):a.append("downloadUrl",e.bagForm.url),e.isEdit&&a.append("id",e.editId),e.$post("appUpgrade/save",a).then(function(t){console.log(t),e.loading2=!1,0==t.code?("1"==e.plat&&e.$refs.upload.clearFiles(),e.$refs.bagForm.resetFields(),e.bagForm.radio="0",e.plat="1",e.fileList=[],e.hasFmt=!1,e.editId="",e.newDialog=!1,e.$message({type:"success",message:t.msg}),setTimeout(function(){e.getList()},500)):e.$message({type:"error",message:t.msg})})}})},beforeClose:function(){var e=this;this.$confirm("关闭后输入的信息将重置!").then(function(){e.$refs.bagForm.resetFields(),e.fileList=[],e.isEdit=!1,e.newDialog=!1,e.plat="1",e.bagForm={radio:"0"},done()}).catch(function(){})},onOff:function(e,t){var a=this,o="";o="2"==e?"上线":"下线",this.$confirm("确定要"+o+"当前应用包吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){var o={tokenId:a.$store.state.user.tokenId,status:e,id:t};a.$post("appUpgrade/onAndOffLine",o).then(function(e){console.log(e),0==e.code&&(setTimeout(function(){a.getList()},500),a.$message({type:"success",message:e.msg}))})}).catch(function(){a.$message({type:"info",message:"已取消操作"})})},deleteBag:function(e){var t=this;this.$confirm("此操作将删除该应用包, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={tokenId:t.$store.state.user.tokenId,status:0,id:e};t.$post("appUpgrade/delete",a).then(function(e){console.log(e),0==e.code?(t.$message({type:"success",message:"删除成功!"}),setTimeout(function(){t.getList()},1e3)):t.$message({type:"info",message:"删除失败!"})})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},getList:function(){var e=this;this.loading=!0;var t={tokenId:this.$store.state.user.tokenId,limit:this.per_page,offset:this.currentPage,platformType:this.source,versionCode:this.filterCode};"0"==this.source&&(t.platformType=""),this.$get("appUpgrade/list",t).then(function(t){console.log(t),0==t.code&&(e.versionData=t.data[0].rows,e.loading=!1,e.total_pages=t.data[0].total)})},miniTable:function(e){return"miniTable"},btnTable:function(e){return"btnTable"},handleCurrentChange:function(e){this.currentPage=e,this.getList()},handleSizeChange:function(e){this.per_page=e,this.getList()},handlePictureCardPreview:function(e){console.log(e),this.dialogImageUrl=e.url,this.imgDialog=!0},fileChange:function(e,t){this.$refs.icon.clearValidate(),this.bagForm.filename=e.name,this.bagForm.file=e.raw,console.log(e.raw),t.length>0&&(this.hasFmt=!0)},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件")},handleRemove:function(e,t){console.log(e,t),0==t.length&&(this.hasFmt=!1)}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-body version"},[a("div",{staticClass:"page-header"},[a("el-select",{attrs:{placeholder:"应用平台",size:"mini"},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}},e._l(e.sources,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",placeholder:"请输入code版本"},model:{value:e.filterCode,callback:function(t){e.filterCode=t},expression:"filterCode"}}),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:e.getList}},[e._v("搜 索")])],1),e._v(" "),a("div",{staticClass:"box"},[a("el-row",{staticClass:"marBo4"},[a("el-col",{attrs:{span:2,offset:22}},[a("el-button",{staticClass:"light_btn text-right",attrs:{size:"mini"},on:{click:function(t){e.newDialog=!0}}},[e._v("上传应用")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.versionData,"row-class-name":e.btnTable,"header-row-class-name":e.btnTable,border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"version_name",label:"版本号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"version_code",label:"code版本"}}),e._v(" "),a("el-table-column",{attrs:{prop:"platform_type",label:"应用平台",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.platform_type?a("p",{staticClass:"yshx"},[e._v("安卓")]):e._e(),e._v(" "),"2"==t.row.platform_type?a("p",{staticClass:"dshx"},[e._v("iOS")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"file_size",label:"应用大小"}}),e._v(" "),a("el-table-column",{attrs:{prop:"package_name",label:"应用包名",width:"260"}}),e._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"修改时间",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.status?a("p",{staticClass:"dshx"},[e._v("新建")]):e._e(),e._v(" "),"2"==t.row.status?a("p",{staticClass:"yshx"},[e._v("已上线")]):e._e(),e._v(" "),"3"==t.row.status?a("p",{staticClass:"yyx"},[e._v("已下线")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.platform_type?a("el-button",{attrs:{type:"text"},on:{click:function(a){e.downBag(t.row.download_url)}}},[e._v("下载")]):a("el-button",{attrs:{type:"text",disabled:""}},[e._v("下载")]),e._v(" "),"2"==t.row.status?a("el-button",{staticClass:"marR10",attrs:{type:"text"},on:{click:function(a){e.onOff("3",t.row.id)}}},[e._v("下线")]):a("el-button",{attrs:{type:"text"},on:{click:function(a){e.onOff("2",t.row.id)}}},[e._v("上线")]),e._v(" "),a("router-link",{attrs:{to:{name:"version-list",params:{id:t.row.id}}}},[a("el-button",{staticClass:"marR10",attrs:{type:"text"}},[e._v("查看")])],1),e._v(" "),"1"==t.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){e.editBag(t.row)}}},[a("i",{staticClass:"iconfont icon-edit"})]):e._e(),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){e.deleteBag(t.row.id)}}},[a("i",{staticClass:"iconfont icon-delete"})])]}}])})],1),e._v(" "),a("div",{staticClass:"marT20"},[a("el-pagination",{staticClass:"text-right",attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{center:"","close-on-click-modal":!1,width:"30%","before-close":e.beforeClose,visible:e.newDialog},on:{"update:visible":function(t){e.newDialog=t}}},[a("div",{staticClass:"el-form-item1"},[a("label",{staticClass:"el-form-item__label1",staticStyle:{width:"110px","line-height":"28px"}},[e._v("\n          应用平台\n        ")]),e._v(" "),a("div",{staticClass:"el-form-item__content1"},[a("el-select",{attrs:{size:"mini",placeholder:"请选择应用平台",disabled:e.isEdit},on:{change:e.selectChange},model:{value:e.plat,callback:function(t){e.plat=t},expression:"plat"}},[a("el-option",{attrs:{label:"安卓",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"iOS",value:"2"}})],1)],1)]),e._v(" "),a("el-form",{ref:"bagForm",staticClass:"bagForm",attrs:{model:e.bagForm,rules:e.bagRules,"label-width":"110px"}},["1"==e.plat?a("el-form-item",{ref:"icon",staticClass:"hei74",attrs:{label:"上传应用包","label-width":"110px",prop:"icon"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"",multiple:!1,limit:1,name:"file","file-list":e.fileList,"auto-upload":!1,"on-exceed":e.handleExceed,"on-preview":e.handlePictureCardPreview,"on-change":e.fileChange,"on-remove":e.handleRemove}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),e._v(" "),a("el-dialog",{attrs:{visible:e.imgDialog},on:{"update:visible":function(t){e.imgDialog=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1):e._e(),e._v(" "),"2"==e.plat?a("el-form-item",{attrs:{label:"上传路径",prop:"url"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:e.bagForm.url,callback:function(t){e.$set(e.bagForm,"url",t)},expression:"bagForm.url"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"版本号",prop:"num"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:e.bagForm.num,callback:function(t){e.$set(e.bagForm,"num",t)},expression:"bagForm.num"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"code版本",prop:"bagcode"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:e.bagForm.bagcode,callback:function(t){e.$set(e.bagForm,"bagcode",t)},expression:"bagForm.bagcode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"应用包名",prop:"bagname"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:e.bagForm.bagname,callback:function(t){e.$set(e.bagForm,"bagname",t)},expression:"bagForm.bagname"}})],1),e._v(" "),a("el-form-item",{staticClass:"hei74",staticStyle:{height:"60px"},attrs:{label:"版本提示",prop:"desc"}},[a("el-input",{staticStyle:{width:"70%",height:"60px"},attrs:{type:"textarea",rows:3},model:{value:e.bagForm.desc,callback:function(t){e.$set(e.bagForm,"desc",t)},expression:"bagForm.desc"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"36px"},attrs:{label:"升级模式",prop:"radio"}},[a("el-radio",{attrs:{label:"0"},model:{value:e.bagForm.radio,callback:function(t){e.$set(e.bagForm,"radio",t)},expression:"bagForm.radio"}},[e._v("可选升级")]),e._v(" "),a("el-radio",{attrs:{label:"1"},model:{value:e.bagForm.radio,callback:function(t){e.$set(e.bagForm,"radio",t)},expression:"bagForm.radio"}},[e._v("强制升级")])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"light_btn",on:{click:e.beforeClose}},[e._v("取 消")]),e._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading2,expression:"loading2",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"light_btn",attrs:{type:"primary","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"},on:{click:e.createBag}},[e._v("保 存")])],1)],1)],1)},staticRenderFns:[]};var s=a("VU/8")(o,i,!1,function(e){a("Xw/t")},null,null);t.default=s.exports},"Xw/t":function(e,t){}});
//# sourceMappingURL=29.1988be90c301466a4716.js.map