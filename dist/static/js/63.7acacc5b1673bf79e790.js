webpackJsonp([63],{"75GW":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=a("bOdI"),r=a.n(i),s=a("Bvqz"),n=a("TIfe"),l=a("RRt9"),c=(a("mtWM"),{components:{UEditor:s.a},data:function(){var e=this;return{tableData:[],currentPage:1,per_page:10,total_pages:1,activeName:"first",config:{toolbars:[["fullscreen","undo","redo","|","bold","italic","underline","fontborder","strikethrough","|","superscript","subscript","|","insertorderedlist","insertunorderedlist","|","removeformat","formatmatch","link","unlink","|","fontfamily","fontsize","justifyleft","justifyright","justifycenter","justifyjustify","indent","pasteplain","blockquote","searchreplace","|","forecolor","backcolor","autotypeset","|","simpleupload","insertimage","emotion","|","lineheight","rowspacingtop","rowspacingbottom","|","edittip ","map","horizontal","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","deletecaption","inserttitle","mergecells","|"]],autoHeightEnabled:!1,autoFloatEnabled:!0,initialContent:"请输入内容",autoClearinitialContent:!0,initialFrameWidth:null,initialFrameHeight:450,BaseUrl:"",UEDITOR_HOME_URL:"static/ueditor/"},uploadVideoing1:!1,uploadVideoing2:!1,editStatus:"2",formDatas:"",columnIds:"",fileList:[],imgFullSrc:"",imgSrc:"",videoUrl:"",videoId:"",showUrl:"",fileListVideo:[],hasChangeFile:!1,fabudao:"",form1:{title:"",content:"",columnId:"",sourceType:"1",source:"",status:"",author:"",userId:"1",imgType:"",newsFile:"",tagLabels:"",keyWords:"",coverImgId:""},pkg:"",quill:{width:420,border:!0,height:150,zIndex:101,syncOutput:!0,theme:"snow",disabled:!1,full:!1,toolbar:[["bold","italic","underline","strike","link",{header:[1,2,3,4,5,6,!1]}],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],[{align:[!1,"right","center","justify"]}],["image","video"]]},bannerDialog:!1,idDetail:"",hasFmt:!0,uploadData:{},form2:"",baceUrl:"",accounts:[],editorOption:{},dialogImageUrl:"",dialogVisible:!1,cities:[],argu:{},rules1:{icon:[{required:!0,validator:function(t,a,o){e.hasFmt?o():o(new Error("请上传封面图"))},trigger:"change"}],title:[{required:!0,validator:l.a.checkTitle,trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"change"},{pattern:/[0-9\u4e00-\u9fa5]+/g,message:"内容必须有中文或者数字",trigger:"blur"}],sourceType:[{required:!0,message:"请选择来源",trigger:"change"}],coverNum:[{required:!0,message:"请选择封面图样式",trigger:"change"}],userId:[{required:!0,message:"请选择发布账号",trigger:"change"}],imgType:[{required:!0,message:"请选择图片",trigger:"change"}],source:[{required:!0,message:"请选择转载来源",trigger:"change"}],columnId:[{required:!0,message:"请选择来源",trigger:"change"}],tagLabels:[{validator:function(e,t,a){""===t?a():t.replace(/，/gi,",").split(",").map(function(e){e.replace(/[^\x00-\xff]/g,"aa").length>12?a(new Error("单个tag标签不能超过12字节!")):a()})},trigger:"blur"}]}}},created:function(){var e=this;this.baceUrl=Object(n.a)(),this.getParams(),this.videoUrl=this.baceUrl+"/news/addVideo",this.argu=this.$route.params.argu,this.$get("/column/findColumnList",{tokenId:this.$store.state.user.tokenId,navigationBar:""}).then(function(t){e.columnIds=t.data})},mounted:function(){var e=this;this.$get("reprintSth/findAll",{tokenId:this.$store.state.user.tokenId}).then(function(t){e.cities=t.data}),this.$post("/members/findByLevel",{tokenId:this.$store.state.user.tokenId,levelCode:100002}).then(function(t){e.accounts=t.data}),this.showNews(),this.getComment()},methods:(o={delCom:function(e){var t=this;this.$confirm("确定要删除这条评论吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$post("/comment/delete",{tokenId:t.$store.state.user.tokenId,id:e.id}).then(function(e){0==e.code&&t.$message({type:"success",message:"删除成功!"}),t.getComment()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},getComment:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,linkId:this.idDetail,limit:this.per_page,offset:this.currentPage};this.$post("/comment/importList",t).then(function(t){0==t.code&&(e.tableData=t.data[0].rows,e.total_pages=t.data[0].total)})},handleSizeChange:function(e){this.per_page=e,this.getComment()},handleCurrentChange:function(e){this.currentPage=e,this.getComment()},tabClick:function(e,t){console.log(e,t)},showPre:function(){var e=this;this.form1.content=this.$refs.ueditor.getUEContent(),this.$refs.form1.validate(function(t){if(t){if(!e.form1.content)return void e.$message({message:"正文内容不可为空!",type:"error"});2==e.form1.sourceType&&e.cities.map(function(t){t.id==e.form1.source&&(e.form1.sourceName=t.name,console.log(e.form1.sourceName))}),e.bannerDialog=!0}})},radioChange:function(e){this.$refs.icon.clearValidate(),"2"==e?this.hasFmt=!0:this.fileList||(this.hasFmt=!1)},fileChange:function(e,t){this.editStatus="1",this.hasChangeFile=!0,this.$refs.icon.clearValidate(),this.form1.filename=e.name,this.form1.newsFile=e.raw,this.fileList=t,console.log(t),t.length>0&&(this.hasFmt=!0)},coverNumChange:function(e){0==e?this.hasFmt=!0:(this.hasFmt=!1,this.fileList&&(this.hasFmt=!0))},uploadFile:function(e){this.formDatas.append("newsFile",e.file)},handleRemove:function(e,t){this.editStatus="1",this.hasChangeFile=!0,this.fileList=t,0==t.length&&(this.hasFmt=!1)},uploadVideo:function(e){var t=this,a=new FormData;a.append("newsVideo",e.file),this.uploadVideoing1=!0,this.uploadVideoing2=!0,this.$post("/news/addVideo",a).then(function(e){0==e.code?(t.uploadVideoing1=!1,t.showUrl=e.data[1],t.videoId=e.data[0],t.$message({message:e.msg,type:"success"})):(t.$message({message:e.msg?e.msg:"操作失败",type:"error"}),t.uploadVideoing1=!1,t.uploadVideoing2=!1)})},editNews:function(e,t){var a=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;if(console.log(e),2==a.form1.imgType){if(!a.form1.content.match(/src=/gi))return void a.$message.error("内容里没有图片!")}if(a.form1.content=a.$refs.ueditor.getUEContent(),a.form1.content){if(a.formDatas=new FormData,a.formDatas.append("tokenId",a.$store.state.user.tokenId),a.formDatas.append("editStatus",a.editStatus),a.formDatas.append("id",a.form1.id),a.formDatas.append("title",a.form1.title),a.formDatas.append("content",a.form1.content),a.formDatas.append("sourceType",a.form1.sourceType),a.formDatas.append("author",a.form1.author),a.formDatas.append("articleType",a.form1.articleType),a.formDatas.append("classifyType",a.form1.classifyType),a.formDatas.append("userId",a.form1.userId),a.formDatas.append("coverNum",a.form1.coverNum),a.formDatas.append("imgType",a.form1.imgType),a.formDatas.append("columnId",a.form1.columnId),a.formDatas.append("tagLabels",a.form1.tagLabels.replace(/，/gi,",")),a.formDatas.append("publishSource","1"),a.formDatas.append("status",t),1==a.editStatus){var o=[];console.log(a.fileList),a.fileList.map(function(e){e.coverImgId&&o.push(e.coverImgId)}),"1"==a.form1.imgType&&a.hasChangeFile&&a.$refs.upload.submit(),console.log(o),a.formDatas.append("imgIds",o)}a.videoId&&(a.formDatas.append("videoId",a.videoId),a.formDatas.append("videoUrl",a.showUrl)),"2"==a.form1.sourceType&&a.formDatas.append("source",a.form1.source);var i=a.$loading({lock:!0,text:"上传中...",target:document.querySelector(".loadingArea"),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.5)"});a.$post("news/edit",a.formDatas).then(function(e){0==e.code?(i.close(),a.$message({message:e.msg,type:"success"}),setTimeout(function(){a.$router.push({name:"news",params:{argu:a.argu}})},1e3)):(i.close(),a.$message({message:e.msg?e.msg:"操作失败",type:"error"}))})}else a.$message({message:"正文内容不可为空!",type:"error"})})},showNews:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,id:this.idDetail};this.$get("news/show",t).then(function(t){0==t.code&&(e.form1=t.data[0],e.form1.videoId&&(e.videoId=e.form1.videoId,e.showUrl=e.form1.videoUrl,e.fileListVideo.push({name:e.form1.videoName,url:e.form1.videoUrl})),setTimeout(function(){e.$refs.ueditor.setContent(e.form1.content,"isAppendTo")},1e3),e.imgSrc=e.form1.coverImgId,e.status=e.form1.status,e.imgFullSrc=e.form1.coverImgUrl,e.form1.newsImgList.map(function(t){e.fileList.push({url:t.coverImgUrl,coverImgId:t.coverImgId})}))})},getParams:function(){var e=this.$route.params.id;this.idDetail=e},uploadImg:function(e,t){console.log(e);var a=new FormData;a.append("file",e,e.name),console.log(e.name),this.$post("images/upload",a).then(function(e){var a=e.data[0].showUrl;t(a,"center"),console.log(e)})},test:function(){console.log(this.form1.source)},onEditorBlur:function(e){e.quill,e.html,e.text}},r()(o,"onEditorBlur",function(e){}),r()(o,"onEditorFocus",function(e){console.log("editor focus!",e)}),r()(o,"onEditorReady",function(e){console.log("editor ready!",e)}),r()(o,"onEditorChange",function(e){var t=e.val;console.log("editor change!",t)}),r()(o,"handleExceed",function(e,t){this.$message.warning("当前限制选择 1 个文件")}),r()(o,"handlePictureCardPreview",function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0}),r()(o,"submitUpload",function(){this.$refs.uploadVideo1.submit()}),r()(o,"handleRemove2",function(e,t){this.showUrl="",this.videoId="",this.uploadVideoing2=!1,this.$message({message:"如果需要,请重新选择视频",type:"info"})}),r()(o,"handleSuccess",function(e,t){console.log(e.data[1]),this.showUrl=e.data[1],this.videoId=e.data[0],console.log(t)}),r()(o,"beforeRemove",function(e,t){var a=this;return this.$confirm("确定移除 "+e.name+"？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.videoId="",a.fileListVideo=[]}).catch(function(){}),!1}),r()(o,"fanhui",function(){var e=this;this.$confirm("返回已编辑内容将重置是否继续？").then(function(t){e.$router.push({name:"news",params:{argu:e.argu}}),done()}).catch(function(e){})}),o),beforeRouteLeave:function(e,t,a){e.meta.keepAlive=!1,a()},watch:{$route:"getParams"}}),d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"page-body news_edit",staticStyle:{"min-width":"980px"}},[o("el-dialog",{attrs:{center:"",width:"30%",visible:e.bannerDialog,"append-to-body":"","before-close":e.handleClose},on:{"update:visible":function(t){e.bannerDialog=t}}},[o("el-form",{ref:"form2",staticClass:"form1",attrs:{data:e.form2,"label-width":"110px"}},[2==e.form1.sourceType?o("div",{staticClass:"zhuan"},[o("p",{staticClass:"title"},[e._v(e._s(e.form1.title))]),e._v(" "),o("div",{staticClass:"pubMsg"},[o("div",{staticClass:"reprint"},[e._v("转载")]),e._v(" "),o("p",{domProps:{innerHTML:e._s(e.form1.author)}}),e._v(" "),o("p",[e._v("转自："),o("span",{domProps:{innerHTML:e._s(e.form1.sourceName)}})]),e._v(" "),o("p",{domProps:{innerHTML:e._s(e.form1.updateTime)}})])]):o("div",{staticClass:"yuan"},[o("div",{staticClass:"pubMsg"},[o("img",{attrs:{id:"img1",src:a("wn7+")}}),e._v(" "),o("p",{staticClass:"title"},[e._v(e._s(e.form1.title))]),e._v(" "),o("p",{domProps:{innerHTML:e._s(e.form1.author)}}),e._v(" "),o("p",{domProps:{innerHTML:e._s(e.form1.updateTime)}})])]),e._v(" "),o("article",{staticClass:"content",domProps:{innerHTML:e._s(e.form1.content)}})])],1),e._v(" "),o("div",{staticClass:"breadcrumb",staticStyle:{padding:"8px"}},[o("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("内容中心")]),e._v(" "),o("el-breadcrumb-item",[e._v("新闻信息")]),e._v(" "),o("el-breadcrumb-item",[e._v("编辑新闻资讯")])],1)],1),e._v(" "),o("div",{staticClass:"box"},[o("div",{staticClass:"text-right marR100"},[o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:e.fanhui}},[e._v("返回")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.showPre()}}},[e._v("预览")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.editNews("form1","0")}}},[e._v("保存")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.editNews("form1","1")}}},[e._v("保存并提交审核")])],1),e._v(" "),o("el-tabs",{on:{"tab-click":e.tabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[o("el-form",{ref:"form1",staticClass:"up_form clearfix",attrs:{model:e.form1,"label-width":"96px",rules:e.rules1}},[o("div",{staticStyle:{width:"48%",float:"left",padding:"15px","margin-left":"2%","margin-right":"5%"}},[o("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[o("el-input",{staticStyle:{width:"420px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入标题"},model:{value:e.form1.title,callback:function(t){e.$set(e.form1,"title",t)},expression:"form1.title"}})],1),e._v(" "),o("el-form-item",{staticClass:"editor",attrs:{label:"文章内容"}},[o("div",{staticStyle:{width:"420px",heigt:"200px"}},[o("UEditor",{ref:"ueditor",attrs:{config:e.config}})],1)])],1),e._v(" "),o("div",{staticStyle:{width:"35%",float:"left",padding:"15px","min-width":"420px"}},[o("el-form-item",{attrs:{label:"发布到:",prop:"columnId"}},[o("el-select",{staticStyle:{"padding-left":"6px"},attrs:{name:"columnId",placeholder:"暂无分类"},model:{value:e.form1.columnId,callback:function(t){e.$set(e.form1,"columnId",t)},expression:"form1.columnId"}},e._l(e.columnIds,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:14}},[o("el-form-item",{attrs:{label:"来源:",prop:"sourceType"}},[o("el-radio-group",{on:{change:function(t){e.test()}},model:{value:e.form1.sourceType,callback:function(t){e.$set(e.form1,"sourceType",t)},expression:"form1.sourceType"}},[o("el-radio",{attrs:{label:"1"}},[e._v("原创")]),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("转载")])],1)],1)],1),e._v(" "),o("el-col",{attrs:{span:10}},[2==e.form1.sourceType?o("el-form-item",{attrs:{prop:"source"}},[o("el-select",{staticStyle:{"margin-left":"-68px",width:"150px"},attrs:{filterable:"","allow-create":"",placeholder:"请选择转载来源"},model:{value:e.form1.source,callback:function(t){e.$set(e.form1,"source",t)},expression:"form1.source"}},e._l(e.cities,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1):e._e()],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"作者:"}},[o("el-input",{model:{value:e.form1.author,callback:function(t){e.$set(e.form1,"author",t)},expression:"form1.author"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"发布账号:",prop:"userId"}},[o("el-select",{attrs:{disabled:"",filterable:""},model:{value:e.form1.userId,callback:function(t){e.$set(e.form1,"userId",t)},expression:"form1.userId"}},e._l(e.accounts,function(e){return o("el-option",{key:e.userId,attrs:{label:e.nickName,value:e.userId}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"封面图样式:",prop:"coverNum"}},[o("el-radio-group",{on:{change:e.coverNumChange},model:{value:e.form1.coverNum,callback:function(t){e.$set(e.form1,"coverNum",t)},expression:"form1.coverNum"}},[o("el-radio",{attrs:{label:0}},[e._v("无图")]),e._v(" "),o("el-radio",{attrs:{label:1}},[e._v("单图")]),e._v(" "),o("el-radio",{attrs:{label:3}},[e._v("三图")])],1)],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"0"!=e.form1.coverNum,expression:"form1.coverNum != '0'"}],ref:"icon",attrs:{label:"封面图类型:",prop:"icon"}},[o("el-radio-group",{on:{change:e.radioChange},model:{value:e.form1.imgType,callback:function(t){e.$set(e.form1,"imgType",t)},expression:"form1.imgType"}},[o("el-radio",{attrs:{label:"1"}},[e._v("上传封面图")]),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("提取正文图为封面图")])],1),e._v(" "),0!=e.form1.coverNum&&"1"==e.form1.imgType?o("el-upload",{ref:"upload",attrs:{action:"",multiple:!0,limit:e.form1.coverNum,name:"newsFile","file-list":e.fileList,"list-type":"picture-card","auto-upload":!1,"http-request":e.uploadFile,"on-change":e.fileChange,"on-exceed":e.handleExceed,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[o("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "),o("el-dialog",{attrs:{visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),o("el-form-item",{attrs:{label:"Tag标签:",prop:"tagLabels"}},[o("el-input",{attrs:{placeholder:"用'，'隔开，单个标签小于12字节"},model:{value:e.form1.tagLabels,callback:function(t){e.$set(e.form1,"tagLabels",t)},expression:"form1.tagLabels"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"文章ID:"}},[o("el-input",{attrs:{disabled:""},model:{value:e.form1.articleId,callback:function(t){e.$set(e.form1,"articleId",t)},expression:"form1.articleId"}})],1)],1)])],1),e._v(" "),o("el-tab-pane",{attrs:{label:"系统信息",name:"second"}},[o("div",{staticClass:"tableOverstyle",staticStyle:{width:"1000px",margin:"auto"}},[o("el-table",{staticClass:"marT20",attrs:{data:e.tableData,border:""}},[o("el-table-column",{attrs:{label:"序号",type:"index",align:"center",width:"50"}}),e._v(" "),o("el-table-column",{attrs:{prop:"content",label:"评论内容"}}),e._v(" "),o("el-table-column",{attrs:{prop:"nick_name",label:"账号"}}),e._v(" "),o("el-table-column",{attrs:{prop:"create_time",label:"评论时间"}}),e._v(" "),o("el-table-column",{attrs:{prop:"date",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{staticClass:"marR10",attrs:{type:"text"},on:{click:function(a){e.delCom(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),o("el-pagination",{staticClass:"text-right marT20",attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)])],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(c,d,!1,function(e){a("zsjW")},null,null);t.default=m.exports},zsjW:function(e,t){}});
//# sourceMappingURL=63.7acacc5b1673bf79e790.js.map