webpackJsonp([57],{"Ff+7":function(t,e){},mzUV:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("TIfe"),i={data:function(){var t=this;return{per_page:20,total_pages:1,currentPage:1,argu:{},hasFmt:!0,hasChangeFile:!1,editStatus:"2",fileList:[],imgFullSrc:"",imgSrc:"",searchInput:"",uploadData:{},baceUrl:"",artData:[],searchLinkArt:[],dialogImageUrl:"",dialogVisible:!1,imageUrl:"",editorOption:{},searchAdd:!1,bannerDialog:!1,subjectForm:{title:"",description:"",tagLabels:"",newsArticleIds:"",ariId:""},subjectRules:{title:[{required:!0,message:"请输入专题名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字",trigger:"blur"}],description:[{required:!0,message:"请输入专题描述",trigger:"blur"},{min:1,max:500,message:"长度在 1 到 500 个字",trigger:"blur"}],icon:[{required:!0,validator:function(e,s,a){t.hasFmt?a():a(new Error("请上传图片"))},trigger:"change"}]}}},created:function(){var t=this;this.baceUrl=Object(a.a)(),this.argu=this.$route.params.argu,this.$get("/specialInfo/show",{tokenId:this.$store.state.user.tokenId,id:this.$route.params.id}).then(function(e){console.log(e),t.subjectForm=e.data[0],t.imgSrc=t.subjectForm.coverImgId,t.status=t.subjectForm.status,t.imgFullSrc=t.subjectForm.coverImgUrl,t.artData=t.subjectForm.specialNews,console.log(t.subjectForm),console.log(t.searchLinkArt),t.fileList.push({url:t.imgFullSrc})})},mounted:function(){},computed:{upDataLength:function(){return this.artData.length-1}},methods:{handleCurrentChange:function(t){this.currentPage=t,this.searchNews()},handleSizeChange:function(t){this.per_page=t,this.searchNews()},showPre:function(){var t=this;this.$refs.subjectForm.validate(function(e){e&&(t.bannerDialog=!0)})},changeIndex:function(t,e,s){if("isUp"==s){var a=e[t],i=e[t-1];e.splice(t-1,1,a),e.splice(t,1,i)}else if("isDown"==s){a=e[t],i=e[t+1];e.splice(t+1,1,a),e.splice(t,1,i)}else if("toTop"==s){a=e[t];e.splice(t,1),e.unshift(a)}else{a=e[t];e.splice(t,1),e.push(a)}},onSuccess:function(){},searchMore:function(){this.searchLinkArt=[],this.searchInput?this.searchNews():this.$message({message:"请输入搜索内容!",type:"warning"})},searchNews:function(){var t=this,e={tokenId:this.$store.state.user.tokenId,idOrTitle:this.searchInput,offset:this.currentPage,limit:this.per_page};this.$post("news/getlist",e).then(function(e){if(console.log(e),e.data[0].rows[0]){var s=e.data[0].rows;t.total_pages=e.data[0].total;var a=[];t.artData.map(function(t){a.push(t.articleId)}),s.map(function(t){-1==a.indexOf(t.articleId)&&(t.flag=!0)}),t.searchLinkArt=s,console.log(t.artData)}else t.$message.error("很抱歉,没有匹配的文章!")})},addById:function(){var t=this,e=!1;if(this.subjectForm.ariId){if(this.artData.map(function(s){if(t.subjectForm.ariId==s.articleId)return t.$message.error("此文章已经被关联!"),void(e=!0)}),e)return;var s={tokenId:this.$store.state.user.tokenId,articleIds:this.subjectForm.ariId};this.$post("news/batchGet",s).then(function(e){console.log(e),e.data[0]?(t.artData.push(e.data[0]),console.log(t.artData)):t.$message.error("请输入正确的文章ID!")})}else this.$message({message:"请输入文章ID添加!",type:"warning"})},addSubject:function(t,e){var s=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var a=new FormData,i=[];s.artData.map(function(t){i.push(t.articleId)}),a.append("tokenId",s.$store.state.user.tokenId),a.append("status",e),a.append("description",s.subjectForm.description),a.append("title",s.subjectForm.title),a.append("tagLabels",s.subjectForm.tagLabels),a.append("newsArticleIds",i.join(",")),s.hasChangeFile&&a.append("file",s.subjectForm.file,s.subjectForm.filename),a.append("id",s.$route.params.id),a.append("editStatus",s.editStatus),s.$post("specialInfo/edit",a).then(function(t){0==t.code&&setTimeout(function(){s.$message({type:"success",message:t.msg}),s.$router.push({name:"subject",params:{argu:s.argu}})},500)})})},fanhui:function(){var t=this;this.$confirm("返回已编辑内容将重置是否继续？").then(function(e){t.$router.push({name:"subject",params:{argu:t.argu}}),done()}).catch(function(t){})},getFullUrl:function(){return this.baceUrl+"/specialInfo/edit"},miniTable:function(t){return"miniTable"},handleClick1:function(t,e,s){1==s?(e.push(t),t.flag=!1,this.$message({message:"关联成功.",type:"success"})):0==s&&(e.splice(t,1),t.flag=!0,this.$message({message:"操作成功.",type:"info"}))},handleClick:function(t,e,s){var a=this;this.$confirm("此操作将取消关联, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.splice(t,1),a.$message({type:"success",message:"操作成功!"})}).catch(function(){a.$message({type:"info",message:"已取消操作"})})},handleRemove:function(t,e){this.hasChangeFile=!0,0==e.length&&(this.hasFmt=!1)},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},fileChange:function(t,e){this.$refs.icon.clearValidate(),this.subjectForm.filename=t.name,this.subjectForm.file=t.raw,this.editStatus="1",console.log(t.raw),e.length>0&&(this.hasFmt=!0)},handleExceed:function(t,e){this.$message.warning("当前限制选择 1 个文件")}},beforeRouteLeave:function(t,e,s){t.meta.keepAlive=!1,s()}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-body subject-edit"},[s("el-dialog",{attrs:{center:"",width:"375px",visible:t.bannerDialog,"append-to-body":""},on:{"update:visible":function(e){t.bannerDialog=e}}},[s("div",{staticClass:"subjectForm"},[s("div",{attrs:{id:"div1"}},[s("div",{staticClass:"mask"}),t._v(" "),s("img",{attrs:{src:t.imgFullSrc}}),t._v(" "),s("div",{attrs:{id:"div_title"}},[s("p",{attrs:{id:"p_title"}},[t._v(t._s(t.subjectForm.title))]),t._v(" "),s("p",{attrs:{id:"div_times"}},[t._v("88位跟踪者 "),s("a"),s("span",[t._v("88分钟前 ")])])])]),t._v(" "),s("div",{attrs:{id:"div2"}},[s("h2",[t._v("导读")]),t._v(" "),s("p",{staticClass:"content1 showClass",attrs:{id:"div2_content"},domProps:{innerHTML:t._s(t.subjectForm.description)}})])])]),t._v(" "),s("div",{staticClass:"breadcrumb",staticStyle:{padding:"8px"}},[s("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[s("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[t._v("内容中心")]),t._v(" "),s("el-breadcrumb-item",[t._v("专题管理")]),t._v(" "),s("el-breadcrumb-item",[t._v("编辑专题")])],1)],1),t._v(" "),s("div",{staticClass:"box"},[s("div",{staticClass:"text-right marBo4",staticStyle:{"margin-right":"50px"}},[s("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:t.fanhui}},[t._v("返回")]),t._v(" "),s("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:t.showPre}},[t._v("预览")]),t._v(" "),s("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(e){t.addSubject("subjectForm",t.subjectForm.status)}}},[t._v("保存")]),t._v(" "),s("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(e){t.addSubject("subjectForm","4")}}},[t._v("保存并上线")])],1),t._v(" "),s("el-form",{ref:"subjectForm",staticStyle:{"max-width":"800px"},attrs:{model:t.subjectForm,rules:t.subjectRules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"专题标题",prop:"title"}},[s("el-input",{model:{value:t.subjectForm.title,callback:function(e){t.$set(t.subjectForm,"title",e)},expression:"subjectForm.title"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"专题描述",prop:"description"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.subjectForm.description,callback:function(e){t.$set(t.subjectForm,"description",e)},expression:"subjectForm.description"}})],1),t._v(" "),s("el-form-item",{ref:"icon",attrs:{label:"封面缩略图",prop:"icon"}},[s("el-upload",{ref:"upload",attrs:{name:"file",multiple:!1,limit:1,action:"","list-type":"picture-card","file-list":t.fileList,"on-change":t.fileChange,"auto-upload":!1,"on-exceed":t.handleExceed,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove}},[s("i",{staticClass:"el-icon-plus"}),t._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("(规格：750x315)")])]),t._v(" "),s("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("img",{attrs:{width:"100%",src:t.imgFullSrc,alt:""}})])],1),t._v(" "),s("el-form-item",{attrs:{label:"tag标签",prop:"tag"}},[s("el-input",{model:{value:t.subjectForm.tagLabels,callback:function(e){t.$set(t.subjectForm,"tagLabels",e)},expression:"subjectForm.tagLabels"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"关联文章",prop:"linkArt"}},[s("el-row",[s("el-col",{attrs:{span:18}},[s("el-input",{model:{value:t.subjectForm.ariId,callback:function(e){t.$set(t.subjectForm,"ariId",e)},expression:"subjectForm.ariId"}})],1),t._v(" "),s("el-col",{staticClass:"text-center",attrs:{span:6}},[s("el-button",{staticClass:"light_btn",on:{click:function(e){t.addById()}}},[t._v("添加")]),t._v(" "),s("el-button",{staticClass:"light_btn",on:{click:function(e){t.searchAdd=!0,t.searchLinkArt=[],t.searchInput=""}}},[t._v("批量添加")])],1)],1)],1),t._v(" "),s("el-form-item",[s("el-table",{attrs:{data:t.artData,border:"","row-class-name":t.miniTable,"header-row-class-name":t.miniTable}},[s("el-table-column",{attrs:{label:"序号",type:"index",align:"center",width:"50"}}),t._v(" "),s("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"390"}}),t._v(" "),s("el-table-column",{attrs:{prop:"articleId",label:"文章ID",width:"100"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?s("el-button",{attrs:{type:"text"},on:{click:function(s){t.changeIndex(e.$index,t.artData,"toTop")}}},[s("i",{staticClass:"iconfont icon-Gototop"})]):s("el-button",{attrs:{type:"text",disabled:""}},[s("i",{staticClass:"iconfont icon-Gototop unclick"})]),t._v(" "),0!=e.$index?s("el-button",{attrs:{type:"text"},on:{click:function(s){t.changeIndex(e.$index,t.artData,"isUp")}}},[s("i",{staticClass:"iconfont icon-up"})]):s("el-button",{attrs:{type:"text",disabled:""}},[s("i",{staticClass:"iconfont icon-up unclick"})]),t._v(" "),e.$index!=t.upDataLength?s("el-button",{attrs:{type:"text"},on:{click:function(s){t.changeIndex(e.$index,t.artData,"isDown")}}},[s("i",{staticClass:"iconfont icon-down"})]):s("el-button",{attrs:{type:"text",disabled:""}},[s("i",{staticClass:"iconfont icon-down",staticStyle:{cursor:"not-allowed"}})]),t._v(" "),e.$index!=t.upDataLength?s("el-button",{attrs:{type:"text"},on:{click:function(s){t.changeIndex(e.$index,t.artData,"toBottom")}}},[s("i",{staticClass:"iconfont icon-Gotobottom"})]):s("el-button",{attrs:{type:"text",disabled:""}},[s("i",{staticClass:"iconfont icon-Gotobottom",staticStyle:{cursor:"not-allowed"}})]),t._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){t.handleClick(e.$index,t.artData,0)}}},[s("i",{staticClass:"iconfont icon-delete-file"})])]}}])})],1)],1),t._v(" "),s("el-form-item",[s("table",{staticClass:"el-table el-table__body el-table--border",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[s("colgroup",[s("col",{attrs:{name:"el-table_1_column_1",width:"30%"}}),t._v(" "),s("col",{attrs:{name:"el-table_1_column_1",width:"70%"}})]),t._v(" "),s("tbody",[s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("发布来源")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v("PC后台\n                    ")])])]),t._v(" "),s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("专题ID")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v("\n                    "+t._s(t.subjectForm.articleId)+"\n                  ")])])]),t._v(" "),s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("状态")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},["0"==t.subjectForm.status?s("span",[t._v("新建")]):t._e(),t._v(" "),"1"==t.subjectForm.status?s("span",[t._v("待审核")]):t._e(),t._v(" "),"2"==t.subjectForm.status?s("span",[t._v("审核中")]):t._e(),t._v(" "),"3"==t.subjectForm.status?s("span",[t._v("审核不通过")]):t._e(),t._v(" "),"4"==t.subjectForm.status?s("span",[t._v("已上线")]):t._e(),t._v(" "),"5"==t.subjectForm.status?s("span",[t._v("已下线")]):t._e()])])])])]),t._v(" "),s("table",{staticClass:"el-table el-table__body el-table--border marT20",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[s("colgroup",[s("col",{attrs:{name:"el-table_1_column_1"}}),t._v(" "),s("col",{attrs:{name:"el-table_1_column_1"}}),t._v(" "),s("col",{attrs:{name:"el-table_1_column_1"}}),t._v(" "),s("col",{attrs:{name:"el-table_1_column_1"}})]),t._v(" "),s("tbody",[s("tr",{staticClass:"el-table__row",staticStyle:{background:"#fafafa","font-weight":"600"}},[s("td",[s("div",{staticClass:"cell"},[t._v("时间类型")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v("时间")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v("操作账号")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v("备注")])])]),t._v(" "),s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("创建时间")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.createTime))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.createUser))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"})])]),t._v(" "),s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("上线时间")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.onlineTime))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.onlineUser))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"})])]),t._v(" "),s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("下线时间")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.offlineTime))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.offlineUser))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"})])]),t._v(" "),s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("修改时间")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.updateTime))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.updateUser))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"})])]),t._v(" "),s("tr",{staticClass:"el-table__row"},[s("td",[s("div",{staticClass:"cell"},[t._v("审核时间")])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s(t.subjectForm.checkTime))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},[t._v(t._s("涉及敏感词"==t.subjectForm.checkReason?"机审":t.subjectForm.checkPerson))])]),t._v(" "),s("td",[s("div",{staticClass:"cell"},["3"==t.subjectForm.status?s("p",[t._v(t._s("其它"==t.subjectForm.checkReason?t.subjectForm.checkMessage:t.subjectForm.checkReason))]):t._e()])])])])])])],1),t._v(" "),s("el-dialog",{attrs:{visible:t.searchAdd},on:{"update:visible":function(e){t.searchAdd=e}}},[s("div",{staticStyle:{"margin-bottom":"20px"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini",placeholder:"请输入搜索内容"},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}}),t._v(" "),s("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:t.searchMore}},[t._v("搜索")])],1),t._v(" "),s("el-table",{attrs:{data:t.searchLinkArt,border:"","row-class-name":t.miniTable,"header-row-class-name":t.miniTable}},[s("el-table-column",{attrs:{label:"序号",type:"index",align:"center",width:"50"}}),t._v(" "),s("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"390"}}),t._v(" "),s("el-table-column",{attrs:{prop:"articleId",label:"文章ID",width:"100"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.flag?s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){t.handleClick1(e.row,t.artData,1)}}},[t._v("关联")]):s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){t.handleClick1(e.row,t.artData,0)}}},[t._v("取消关联")])]}}])})],1),t._v(" "),s("el-pagination",{staticClass:"text-right marT20",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)],1)},staticRenderFns:[]};var c=s("VU/8")(i,l,!1,function(t){s("Ff+7")},null,null);e.default=c.exports}});
//# sourceMappingURL=57.2e2c4dd48cadd609c78d.js.map