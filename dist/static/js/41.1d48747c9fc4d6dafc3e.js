webpackJsonp([41],{"75GW":function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=l("TIfe"),s=(l("mtWM"),{components:{},data:function(){var e=this;return{fileList:[],imgFullSrc:"",imgSrc:"",form1:{title:"",content:"",column:"新闻资讯",sourceType:"1",source:"",status:"",author:"",userId:"1",imgType:"1",newsFile:"",tagLabels:"",keyWords:"",coverImgId:""},type:"新闻",pkg:"",quill:{width:420,border:!0,height:150,zIndex:101,content:"wellcome ~",syncOutput:!1,theme:"snow",disabled:!1,full:!1,toolbar:[[{header:1},{header:2}],["bold","italic","underline","strike","link"]]},bannerDialog:!1,idDetail:"",hasFmt:!0,uploadData:{},baceUrl:"",accounts:[],editorOption:{},dialogImageUrl:"",dialogVisible:!1,cities:[],rules1:{icon:[{required:!0,validator:function(t,l,o){e.hasFmt?o():o(new Error("请上传封面图"))},trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:3,max:45,message:"长度在 3 到 45 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"change"}],sourceType:[{required:!0,message:"请选择来源",trigger:"change"}],userId:[{required:!0,message:"请选择发布账号",trigger:"change"}],imgType:[{required:!0,message:"请选择图片",trigger:"change"}],source:[{required:!0,message:"请选择转载来源",trigger:"change"}],tagLabels:[{validator:function(e,t,l){""===t?l():t.replace(/，/gi,",").split(",").map(function(e){e.replace(/[^\x00-\xff]/g,"aa").length>12?l(new Error("单个tag标签不能超过12字节!")):l()})},trigger:"blur"}]}}},created:function(){this.baceUrl=Object(o.a)(),this.getParams()},mounted:function(){var e=this;this.showNews(),this.$get("reprintSth/findAll",{tokenId:this.$store.state.user.tokenId}).then(function(t){console.log(t.data),e.cities=t.data}),this.$post("members/findByLevel",{tokenId:this.$store.state.user.tokenId,levelCode:100002}).then(function(t){console.log(t),e.accounts=t.data})},methods:{fileChange:function(e,t){this.$refs.icon.clearValidate(),this.form1.newsFile=e.raw,console.log(t.length),t.length>0&&(this.hasFmt=!0)},editNews:function(e,t){var l=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;if(console.log(e),"2"!=l.form1.sourceType||l.form1.source)if(2==l.form1.imgType){if(l.form1.content.match(/src=/gi)){var o={tokenId:l.$store.state.user.tokenId,status:t,id:l.idDetail,title:l.form1.title,content:l.form1.content,sourceType:l.form1.sourceType,source:l.form1.source,author:l.form1.author,userId:l.form1.userId,imgType:l.form1.imgType,tagLabels:l.form1.tagLabels,keyWords:l.form1.keyWords,publishSource:"1"};l.$post("news/edit",o).then(function(e){0==e.code&&setTimeout(function(){l.$router.push({name:"news"})},1e3)})}else l.$message.error("内容里没有图片!")}else{if(!l.hasFmt)return void l.$message.error("请上传封面图!");l.uploadData={tokenId:l.$store.state.user.tokenId,id:l.idDetail,status:t,title:l.form1.title,content:l.form1.content,sourceType:l.form1.sourceType,editStatus:"1",source:l.form1.source,articleId:l.form1.articleId,author:l.form1.author,userId:l.form1.userId,imgType:l.form1.imgType,tagLabels:l.form1.tagLabels,keyWords:l.form1.keyWords,publishSource:"1"},console.log(l.uploadData),setTimeout(function(){l.$refs.upload.submit(),l.$message({type:"success",message:"添加成功!"}),setTimeout(function(){l.$router.push({name:"news"})},1e3)},0)}else l.$message.error("请选择转载来源!")})},showNews:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,id:this.idDetail};this.$get("news/show",t).then(function(t){e.form1=t.data[0],console.log(e.form1),e.imgSrc=e.form1.coverImgId,e.status=e.form1.status,e.imgFullSrc=e.baceUrl+e.imgSrc,console.log(e.imgFullSrc),e.fileList.push({url:e.imgFullSrc})})},getParams:function(){var e=this.$route.params.id;this.idDetail=e},uploadImg:function(e,t){var l=this;console.log(e);var o=new FormData;o.append("file",e,e.name),console.log(e.name),this.$post("images/upload",o).then(function(e){var o=l.baceUrl+e.data[0].showUrl;t(o,"center"),console.log(e)})},getFullUrl:function(){return this.baceUrl+"/news/edit"},test:function(){console.log(this.form1.source)},onEditorBlur:function(e){this.form1.content=e.container.innerHTML,console.log(e),console.log(e.container.innerHTML),console.log(this.form1.content)},onEditorFocus:function(e){console.log("editor focus!",e)},onEditorReady:function(e){console.log("editor ready!",e)},onEditorChange:function(e){console.log("editor change!",e)},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件")},handleRemove:function(e,t){console.log(e,t),0==t.length&&(this.hasFmt=!1)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},fanhui:function(){var e=this;this.$confirm("返回已编辑内容将重置是否继续？").then(function(t){e.$router.back(),done()}).catch(function(e){})}},watch:{$route:"getParams"}}),r={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"page-body news_edit",staticStyle:{"min-width":"1080px"}},[l("el-dialog",{attrs:{center:"",width:"375px",visible:e.bannerDialog,id:"div1"},on:{"update:visible":function(t){e.bannerDialog=t}}},[l("el-form",{ref:"form1",staticClass:"form1",attrs:{data:e.form1,model:e.form1,"label-width":"110px"}},[l("p",{attrs:{id:"p1"}},[e._v(e._s(e.form1.title))]),e._v(" "),l("p",{attrs:{id:"p2"},domProps:{innerHTML:e._s(e.form1.content)}})])],1),e._v(" "),l("div",{staticClass:"breadcrumb",staticStyle:{padding:"8px"}},[l("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[l("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("内容中心")]),e._v(" "),l("el-breadcrumb-item",[e._v("新闻信息")]),e._v(" "),l("el-breadcrumb-item",[e._v("编辑新闻资讯")])],1)],1),e._v(" "),l("div",{staticClass:"box"},[l("div",{staticClass:"text-right marR100"},[l("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:e.fanhui}},[e._v("返回")]),e._v(" "),l("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.bannerDialog=!0}}},[e._v("预览")]),e._v(" "),l("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.editNews("form1",0)}}},[e._v("保存")])],1),e._v(" "),l("el-form",{ref:"form1",staticClass:"up_form clearfix",attrs:{model:e.form1,"label-width":"80px",rules:e.rules1}},[l("div",{staticStyle:{width:"48%",float:"left",padding:"15px","margin-left":"2%","margin-right":"5%"}},[l("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[l("el-input",{model:{value:e.form1.title,callback:function(t){e.$set(e.form1,"title",t)},expression:"form1.title"}})],1),e._v(" "),l("el-form-item",{staticClass:"editor",attrs:{label:"文章内容",prop:"content"}},[l("m-quill-editor",{ref:"myQuillEditor",attrs:{width:e.quill.width,getContent:e.onEditorChange,"has-border":e.quill.border,zIndex:e.quill.zIndex,"sync-output":e.quill.syncOutput,theme:e.quill.theme,disabled:e.quill.disabled,fullscreen:e.quill.full},on:{upload:e.uploadImg,blur:function(t){e.onEditorBlur(t)}},model:{value:e.form1.content,callback:function(t){e.$set(e.form1,"content",t)},expression:"form1.content"}})],1)],1),e._v(" "),l("div",{staticStyle:{width:"35%",float:"left",padding:"15px","min-width":"420px"}},[l("el-form-item",{attrs:{label:"发布到:"}},[l("el-input",{attrs:{disabled:""},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"来源:",prop:"sourceType"}},[l("el-radio-group",{on:{change:function(t){e.test()}},model:{value:e.form1.sourceType,callback:function(t){e.$set(e.form1,"sourceType",t)},expression:"form1.sourceType"}},[l("el-radio",{attrs:{label:"1"}},[e._v("原创")]),e._v(" "),l("el-radio",{attrs:{label:"2"}},[e._v("转载")])],1),e._v(" "),2==e.form1.sourceType?l("el-select",{staticStyle:{"margin-left":"20px",width:"140px"},attrs:{placeholder:"请选择来源"},model:{value:e.form1.source,callback:function(t){e.$set(e.form1,"source",t)},expression:"form1.source"}},e._l(e.cities,function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})):e._e()],1),e._v(" "),l("el-form-item",{attrs:{label:"作者:"}},[l("el-input",{model:{value:e.form1.author,callback:function(t){e.$set(e.form1,"author",t)},expression:"form1.author"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"发布账号:",prop:"userId","label-width":"82"}},[l("el-select",{model:{value:e.form1.userId,callback:function(t){e.$set(e.form1,"userId",t)},expression:"form1.userId"}},e._l(e.accounts,function(e){return l("el-option",{key:e.userId,attrs:{label:e.nickName,value:e.userId}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"附加选项:",prop:"imgType","label-width":"82"}},[l("el-radio-group",{model:{value:e.form1.imgType,callback:function(t){e.$set(e.form1,"imgType",t)},expression:"form1.imgType"}},[l("el-radio",{attrs:{label:"1"}},[e._v("上传缩略图")]),e._v(" "),l("el-radio",{attrs:{label:"2"}},[e._v("提取第一个图为缩略图")])],1)],1),e._v(" "),"1"==e.form1.imgType?l("el-form-item",{ref:"icon",attrs:{prop:"icon",label:"封面图"}},[l("el-upload",{ref:"upload",attrs:{action:"",data:e.uploadData,multiple:!1,limit:1,name:"newsFile","file-list":e.fileList,"list-type":"picture-card","auto-upload":!1,"on-change":e.fileChange,"on-exceed":e.handleExceed,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[l("i",{staticClass:"el-icon-plus"})]),e._v(" "),l("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[l("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1):e._e(),e._v(" "),l("el-form-item",{attrs:{label:"Tag标签:",prop:"tagLabels"}},[l("el-input",{attrs:{placeholder:"用'，'隔开，单个标签小于12字节"},model:{value:e.form1.tagLabels,callback:function(t){e.$set(e.form1,"tagLabels",t)},expression:"form1.tagLabels"}})],1),e._v(" "),l("table",{staticClass:"el-table el-table__body el-table--border marT20",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[l("colgroup",[l("col",{attrs:{name:"el-table_1_column_1",width:"18%"}}),e._v(" "),l("col",{attrs:{name:"el-table_1_column_1",width:"36%"}}),e._v(" "),l("col",{attrs:{name:"el-table_1_column_1",width:"36%"}})]),e._v(" "),l("tbody",[l("tr",{staticClass:"el-table__row"},[l("td",[l("div",{staticClass:"cell"})]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v("时间")])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v("操作账号")])])]),e._v(" "),l("tr",{staticClass:"el-table__row"},[l("td",[l("div",{staticClass:"cell"},[e._v("创建时间")])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.createTime))])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.createUser))])])]),e._v(" "),l("tr",{staticClass:"el-table__row"},[l("td",[l("div",{staticClass:"cell"},[e._v("上线时间")])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.onlineTime))])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.onlineUser))])])]),e._v(" "),l("tr",{staticClass:"el-table__row"},[l("td",[l("div",{staticClass:"cell"},[e._v("下线时间")])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.offlineTime))])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.offlineUser))])])]),e._v(" "),l("tr",{staticClass:"el-table__row"},[l("td",[l("div",{staticClass:"cell"},[e._v("修改时间")])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.updateTime))])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.updateUser))])])]),e._v(" "),l("tr",{staticClass:"el-table__row"},[l("td",[l("div",{staticClass:"cell"},[e._v("审核时间")])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.checkTime))])]),e._v(" "),l("td",[l("div",{staticClass:"cell"},[e._v(e._s(e.form1.checkPerson))])])])])])],1)])],1)],1)},staticRenderFns:[]};var a=l("VU/8")(s,r,!1,function(e){l("sMOn")},null,null);t.default=a.exports},sMOn:function(e,t){}});
//# sourceMappingURL=41.1d48747c9fc4d6dafc3e.js.map