webpackJsonp([5],{"9ty7":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("TIfe"),r=o("RRt9"),i=(o("mtWM"),{components:{},data:function(){var e=this;return{uploadVideoing1:!1,uploadVideoing2:!1,formDatas:"",accounts:[],fileList:[],fileListVideo:[],showNews:!1,pkg:"",quill:{width:420,border:!0,height:150,zIndex:101,content:"wellcome ~",syncOutput:!0,theme:"snow",disabled:!1,full:!1,toolbar:[["bold","italic","underline","strike","link",{header:[1,2,3,4,5,6,!1]}],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],[{align:[!1,"right","center","justify"]}],["image","video"]]},uploadData:{},baceUrl:"",editorOption:{},dialogImageUrl:"",dialogVisible:!1,form1:{title:"",content:"",coverNum:0,sourceType:"1",columnId:"",source:"",author:"",userId:"",imgType:"0",newsFile:"",tagLabels:"",keyWords:""},cities:[],hasFmt:!0,showUrl:"",argu:{},videoUrl:"",columnIds:"",videoId:"",rules1:{icon:[{required:!0,validator:function(t,o,a){e.hasFmt?a():a(new Error("请上传封面图"))},trigger:"change"}],title:[{required:!0,validator:r.a.checkTitle,trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{pattern:/[0-9\u4e00-\u9fa5]+/g,message:"内容必须有中文或者数字",trigger:"blur"}],sourceType:[{required:!0,message:"请选择来源",trigger:"change"}],coverNum:[{required:!0,message:"请选择封面图样式",trigger:"change"}],source:[{required:!0,message:"请选择转载来源",trigger:"change"}],columnId:[{required:!0,message:"请选择来源",trigger:"change"}],userId:[{required:!0,message:"请选择发布账号",trigger:"change"}],imgType:[{required:!0,message:"请选择封面图类型",trigger:"change"}],tagLabels:[{validator:function(e,t,o){""===t?o():(console.log(t),t.replace(/，/gi,",").split(",").map(function(e){e.replace(/[^\x00-\xff]/g,"aa").length>12?o(new Error("单个tag标签不能超过12字节!")):o()}))},trigger:"blur"}]}}},created:function(){var e=this;this.baceUrl=Object(a.a)(),this.videoUrl=this.baceUrl+"/news/addVideo",this.$get("/column/findColumnList",{tokenId:this.$store.state.user.tokenId,navigationBar:""}).then(function(t){e.columnIds=t.data}),this.argu=this.$route.params.argu},mounted:function(){var e=this;this.$get("reprintSth/findAll",{tokenId:this.$store.state.user.tokenId}).then(function(t){e.cities=t.data}),this.$post("members/findByLevel",{tokenId:this.$store.state.user.tokenId,levelCode:100002}).then(function(t){e.accounts=t.data})},methods:{beforeUpload:function(e){console.log(e)},uploadVideo:function(e){var t=this,o=new FormData;o.append("newsVideo",e.file),this.uploadVideoing1=!0,this.uploadVideoing2=!0,this.$post("/news/addVideo",o).then(function(e){0==e.code?(t.uploadVideoing1=!1,t.showUrl=e.data[1],t.videoId=e.data[0],t.$message({message:e.msg,type:"success"})):(t.$message({message:e.msg?e.msg:"操作失败",type:"error"}),t.uploadVideoing1=!1,t.uploadVideoing2=!1)})},radioChange:function(e){this.$refs.icon.clearValidate(),"2"==e?this.hasFmt=!0:this.fileList||(this.hasFmt=!1)},coverNumChange:function(e){0==e?(this.hasFmt=!0,this.form1.imgType="0"):(this.hasFmt=!1,2!=this.form1.imgType&&(this.form1.imgType="1"),this.fileList.length>0&&(this.hasFmt=!0))},exceedFile:function(){this.$message.warning("只能上传一个视频!")},uploading:function(e,t,o){},uploadImg:function(e,t){console.log(e);var o=new FormData;o.append("file",e,e.name),this.$post("images/upload",o).then(function(e){var o=e.data[0].showUrl;console.log(t),t(o,"center")})},videoChange:function(e,t){console.log(e,t);var o=new FormData;o.append("file",e,e.name),this.$post("images/upload",o).then(function(e){console.log(e)})},submitUpload:function(){console.log(this.fileListVideo),this.$refs.uploadVideo1.submit()},handleRemove2:function(e,t){this.showUrl="",this.videoId="",this.uploadVideoing2=!1,this.$message({message:"如果需要,请重新选择视频",type:"info"})},handleSuccess:function(e,t){console.log(t)},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},getFullUrl:function(){return this.baceUrl+"/news/add"},uploadFile:function(e){this.formDatas.append("newsFile",e.file)},creatNews:function(e,t){var o=this;console.log(this.hasFmt),this.$refs[e].validate(function(e){if(console.log(e),e){if(o.formDatas=new FormData,"1"==o.form1.imgType&&o.$refs.upload.submit(),3==o.form1.coverNum&&3!=o.fileList.length)return void o.$message({message:"必须满足上传三张图片!",type:"error"});o.formDatas.append("tokenId",o.$store.state.user.tokenId),o.formDatas.append("title",o.form1.title),o.formDatas.append("content",o.form1.content),o.formDatas.append("sourceType",o.form1.sourceType),o.formDatas.append("author",o.form1.author),o.formDatas.append("userId",o.form1.userId),o.formDatas.append("coverNum",o.form1.coverNum),o.formDatas.append("imgType",o.form1.imgType),o.formDatas.append("columnId",o.form1.columnId),o.formDatas.append("tagLabels",o.form1.tagLabels.replace(/，/gi,",")),o.formDatas.append("publishSource","1"),o.formDatas.append("status",t),"2"==o.form1.sourceType&&o.formDatas.append("source",o.form1.source),o.videoId&&(o.formDatas.append("videoId",o.videoId),o.formDatas.append("videoUrl",o.showUrl));var a=o.$loading({lock:!0,text:"上传中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.5)"});o.$post("news/add",o.formDatas).then(function(e){console.log(e),0==e.code?(a.close(),o.$message({message:e.msg,type:"success"}),setTimeout(function(){o.$router.push({name:"news",params:{argu:o.argu}})},1e3)):o.$message({message:e.msg?e.msg:"发布失败",type:"error"})})}})},creatNewsOld:function(e,t){var o=this;this.$refs[e].validate(function(e){if(console.log(e),!e)return console.log("error submit!!"),!1;if(2==o.form1.imgType){if(!o.form1.content.match(/http:\/\/.*?(gif|png|jpg|jpeg)/gi))return void o.$message.error("内容里没有图片!")}o.param=new FormData,param.append("tokenId",o.$store.state.user.tokenId),param.append("title",o.form1.title),param.append("content",o.form1.content),param.append("sourceType",o.form1.sourceType),param.append("author",o.form1.author),param.append("userId",o.form1.userId),param.append("coverNum",o.form1.coverNum),param.append("imgType",o.form1.imgType),param.append("columnId",o.form1.columnId),param.append("tagLabels",o.form1.tagLabels.replace(/，/gi,",")),param.append("publishSource","1"),param.append("status",t),"1"==o.form1.imgType&&(param.append("newsFile",o.form1.newsFile,o.form1.filename),console.log(o.fileList)),"2"==o.form1.sourceType&&param.append("source",o.form1.source),o.videoId&&(param.append("videoId",o.videoId),param.append("videoUrl",o.showUrl)),console.log(o.form1.newsFile),o.$post("news/add",param).then(function(e){0==e.code&&(o.$message({message:e.msg,type:"success"}),setTimeout(function(){o.$router.push({name:"news",params:{argu:o.argu}})},1e3))})})},fileChange:function(e,t){this.$refs.icon.clearValidate(),this.form1.filename=e.name,this.form1.newsFile=e.raw,this.fileList=t,t.length>0&&(this.hasFmt=!0)},onEditorBlur:function(e){e.quill,e.html,e.text;console.log(this.form1.content)},onEditorFocus:function(e){console.log("editor focus!",e)},onEditorReady:function(e){console.log("editor ready!",e)},onEditorChange:function(e){console.log("editor change!",e)},handleRemove:function(e,t){console.log(e,t),0==t.length&&(this.hasFmt=!1)},handleExceed:function(e,t){this.$message.warning("当前限制上传 "+this.form1.coverNum+"个文件")},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},fanhui:function(){var e=this;this.$confirm("返回已编辑内容将重置是否继续？").then(function(t){e.$router.push({name:"news",params:{argu:e.argu}}),done()}).catch(function(e){})}},beforeRouteLeave:function(e,t,o){e.meta.keepAlive=!0,o()}}),s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"page-body news-add",staticStyle:{"min-width":"980px"}},[o("el-dialog",{attrs:{center:"",width:"375px",visible:e.showNews,"append-to-body":"",id:"div1"},on:{"update:visible":function(t){e.showNews=t}}},[o("el-form",{ref:"form1",staticClass:"form1",attrs:{data:e.form1,"label-width":"110px"}},[o("p",{attrs:{id:"p1"}},[e._v(e._s(e.form1.title))]),e._v(" "),o("p",{attrs:{id:"p2"},domProps:{innerHTML:e._s(e.form1.content)}})])],1),e._v(" "),o("div",{staticClass:"breadcrumb",staticStyle:{padding:"8px"}},[o("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("内容中心")]),e._v(" "),o("el-breadcrumb-item",[e._v("发布内容")]),e._v(" "),o("el-breadcrumb-item",[e._v("发布新闻资讯")])],1)],1),e._v(" "),o("div",{staticClass:"box"},[o("div",{staticClass:"text-right marR100"},[o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:e.fanhui}},[e._v("返回")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.showNews=!0}}},[e._v("预览")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.creatNews("form1",0)}}},[e._v("仅保存")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.creatNews("form1","1")}}},[e._v("保存并提交审核")])],1),e._v(" "),o("el-form",{ref:"form1",staticClass:"up_form clearfix",attrs:{model:e.form1,"label-width":"96px",rules:e.rules1}},[o("div",{staticStyle:{width:"48%",float:"left",padding:"15px","margin-left":"2%","margin-right":"5%"}},[o("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[o("el-input",{staticStyle:{width:"420px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入标题"},model:{value:e.form1.title,callback:function(t){e.$set(e.form1,"title",t)},expression:"form1.title"}})],1),e._v(" "),o("el-form-item",{staticClass:"editor",attrs:{label:"文章内容",prop:"content"}},[o("m-quill-editor",{ref:"myQuillEditor",attrs:{width:e.quill.width,getContent:e.onEditorChange,toolbar:e.quill.toolbar,"has-border":e.quill.border,zIndex:e.quill.zIndex,"sync-output":e.quill.syncOutput,theme:e.quill.theme,disabled:e.quill.disabled,fullscreen:e.quill.full},on:{upload:e.uploadImg,blur:function(t){e.onEditorBlur(t)}},model:{value:e.form1.content,callback:function(t){e.$set(e.form1,"content",t)},expression:"form1.content"}})],1)],1),e._v(" "),o("div",{staticStyle:{width:"35%",float:"left",padding:"15px","min-width":"420px"}},[o("el-form-item",{attrs:{label:"发布到:",prop:"columnId"}},[o("el-select",{attrs:{filterable:"",name:"columnId",placeholder:"请选择"},model:{value:e.form1.columnId,callback:function(t){e.$set(e.form1,"columnId",t)},expression:"form1.columnId"}},e._l(e.columnIds,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:16}},[o("el-form-item",{attrs:{label:"来源:",prop:"sourceType"}},[o("el-radio-group",{model:{value:e.form1.sourceType,callback:function(t){e.$set(e.form1,"sourceType",t)},expression:"form1.sourceType"}},[o("el-radio",{attrs:{label:"1"}},[e._v("原创")]),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("转载")])],1)],1)],1),e._v(" "),o("el-col",{attrs:{span:8}},[2==e.form1.sourceType?o("el-form-item",{staticClass:"source_style",attrs:{prop:"source"}},[o("el-select",{staticStyle:{"margin-left":"-68px",width:"150px"},attrs:{filterable:"","allow-create":"",placeholder:"请选择转载来源"},model:{value:e.form1.source,callback:function(t){e.$set(e.form1,"source",t)},expression:"form1.source"}},e._l(e.cities,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1):e._e()],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"作者:"}},[o("el-input",{staticStyle:{width:"194px"},model:{value:e.form1.author,callback:function(t){e.$set(e.form1,"author",t)},expression:"form1.author"}})],1),e._v(" "),o("el-form-item",{staticClass:"fabuStyle",attrs:{label:"发布账号:",prop:"userId"}},[o("el-select",{attrs:{filterable:"",placeholder:"请选择发布账号"},model:{value:e.form1.userId,callback:function(t){e.$set(e.form1,"userId",t)},expression:"form1.userId"}},e._l(e.accounts,function(e){return o("el-option",{key:e.userId,attrs:{label:e.nickName,value:e.userId}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"封面图样式:",prop:"coverNum"}},[o("el-radio-group",{on:{change:e.coverNumChange},model:{value:e.form1.coverNum,callback:function(t){e.$set(e.form1,"coverNum",t)},expression:"form1.coverNum"}},[o("el-radio",{attrs:{label:0}},[e._v("无图")]),e._v(" "),o("el-radio",{attrs:{label:1}},[e._v("单图")]),e._v(" "),o("el-radio",{attrs:{label:3}},[e._v("三图")])],1)],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"0"!=e.form1.coverNum,expression:"form1.coverNum != '0'"}],attrs:{label:"封面图类型:"}},[o("el-radio-group",{on:{change:e.radioChange},model:{value:e.form1.imgType,callback:function(t){e.$set(e.form1,"imgType",t)},expression:"form1.imgType"}},[o("el-radio",{attrs:{label:"1"}},[e._v("上传封面图")]),e._v(" "),o("el-radio",{attrs:{label:"2"}},[e._v("提取正文图为封面图")])],1)],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"0"!=e.form1.coverNum&&"1"==e.form1.imgType,expression:"form1.coverNum != '0'&&form1.imgType == '1'"}],ref:"icon",attrs:{label:"封面图:",prop:"icon"}},[o("el-upload",{ref:"upload",attrs:{action:"",multiple:!1,limit:e.form1.coverNum,name:"newsFile","file-list":e.fileList,"list-type":"picture-card","auto-upload":!1,"http-request":e.uploadFile,"on-change":e.fileChange,"on-exceed":e.handleExceed,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[o("i",{staticClass:"el-icon-plus"})]),e._v(" "),o("el-dialog",{attrs:{visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),o("el-form-item",{attrs:{label:"上传视频:"}},[o("el-upload",{ref:"uploadVideo1",staticClass:"upload-demo",attrs:{limit:1,name:"newsVideo",action:"",accept:"video/mp4","on-remove":e.handleRemove2,"before-upload":e.beforeUpload,"http-request":e.uploadVideo,"on-progress":e.uploading,"file-list":e.fileListVideo,"on-success":e.handleSuccess,"on-exceed":e.exceedFile,"before-remove":e.beforeRemove,"auto-upload":!1}},[o("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取视频")]),e._v(" "),o("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success",loading:e.uploadVideoing1,disabled:e.uploadVideoing2},on:{click:e.submitUpload}},[e._v("点击上传视频")]),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请选择mp4文件进行上传")])],1)],1),e._v(" "),e.videoId?o("el-form-item",{attrs:{label:"视频预览:"}},[o("video",{staticStyle:{background:"rgba(0,0,0,0.7)"},attrs:{width:"320",height:"240",controls:""}},[o("source",{attrs:{src:e.showUrl,type:"video/mp4"}})])]):e._e(),e._v(" "),o("el-form-item",{attrs:{label:"Tag标签:",prop:"tagLabels"}},[o("el-input",{attrs:{placeholder:"用'，'隔开，单个标签小于12字节"},model:{value:e.form1.tagLabels,callback:function(t){e.$set(e.form1,"tagLabels",t)},expression:"form1.tagLabels"}})],1)],1)])],1)],1)},staticRenderFns:[]};var l=o("VU/8")(i,s,!1,function(e){o("mswm")},null,null);t.default=l.exports},mswm:function(e,t){}});
//# sourceMappingURL=5.9bb38a312678b5f65f30.js.map