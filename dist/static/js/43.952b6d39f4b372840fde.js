webpackJsonp([43],{FYny:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),n=a("rx7x"),l=a("TIfe"),o={data:function(){return{navigationBar:"",options:[{value:"2",label:"全部"},{value:"0",label:"推荐栏目"},{value:"1",label:"我的栏目"}],dialogVisible:!1,pictureId:"",upData:[],columnName:"",hasChangeFile:!1,fileList:[],isEdit:!1,editId:"",newDialog:!1,imgDialog:!1,dialogImageUrl:"",loading:!1,loading2:!1,baceUrl:"",miniTable:n.miniTable,btnTable:n.btnTable,per_page:10,total_pages:0,currentPage:1,tableData:[],input:"",classForm:{name:"",enabled:"1",navigation_bar:"0"},classRules:{name:[{required:!0,message:"请输入标题",trigger:"blur"},{min:2,max:4,message:"长度在 2 到 4 个字",trigger:"blur"}],icon:[]},hasFmt:!1}},created:function(){this.baceUrl=Object(l.a)(),this.getList()},methods:{publishWaitTop:function(){var t=this;this.dialogVisible=!0,this.loading2=!0,this.$get("column/findColumnList",{tokenId:this.$store.state.user.tokenId,navigationBar:"1"}).then(function(e){0==e.code&&(t.loading2=!1,t.upData=e.data)})},changeIndex:function(t,e,a){if("isUp"==a){var i=e[t],s=e[t-1];e.splice(t-1,1,i),e.splice(t,1,s)}else if("isDown"==a){i=e[t],s=e[t+1];e.splice(t+1,1,i),e.splice(t,1,s)}else if("toTop"==a){i=e[t];e.splice(t,1),e.unshift(i)}else{i=e[t];e.splice(t,1),e.push(i)}},toPublish:function(){var t=this,e=[];this.upData.map(function(t,a){e.push(t.id)});var a={tokenId:this.$store.state.user.tokenId,ids:e.join(",")};this.$post("/column/updateByBarAndOrder",a).then(function(e){0==e.code&&t.$message({message:e.msg,type:"success"})}),this.dialogVisible=!1},order:function(t,e,a){var i=this,s={},n="";1==a?(s={tokenId:this.$store.state.user.tokenId,firstId:this.tableData[t-1].id,lastId:e},n="/column/updateByOrder"):2==a?(s={tokenId:this.$store.state.user.tokenId,firstId:e,lastId:this.tableData[t+1].id},n="/column/updateByOrder"):3==a?(s={tokenId:this.$store.state.user.tokenId,operType:"0",id:this.tableData[t].id},n="/column/stickOrBottom"):(s={tokenId:this.$store.state.user.tokenId,operType:"1",id:this.tableData[t].id},n="/column/stickOrBottom"),this.$post(n,s).then(function(t){0==t.code?(i.$message({type:"success",message:t.msg}),i.getList(i.currentPage)):i.$message({type:"warning",message:t.msg?t.msg:"操作失败"})})},editClass:function(t){this.newDialog=!0,this.hasChangeFile=!1,this.classForm=JSON.parse(s()(t)),t.picture_url&&this.fileList.push({url:t.picture_url}),this.hasFmt=!0,this.editId=t.id,this.pictureId=t.picture_id,this.isEdit=!0},createClass:function(){var t=this;this.$refs.classForm.validate(function(e){if(e){var a=t.$loading({lock:!0,target:document.querySelector(".app-container"),text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),i=new FormData;i.append("tokenId",t.$store.state.user.tokenId),i.append("name",t.classForm.name),i.append("enabled",t.classForm.enabled),i.append("navigationBar",t.classForm.navigation_bar),t.isEdit&&(i.append("id",t.editId),i.append("pictureId",t.pictureId)),t.hasChangeFile?i.append("newsFile",t.classForm.file,t.classForm.filename):i.append("newsFile",""),t.$post("column/save",i).then(function(e){t.newDialog=!1,a.close(),t.$refs.upload.clearFiles(),t.$refs.classForm.resetFields(),t.classForm.navigation_bar="0",t.classForm.enabled="1",t.fileList=[],0==e.code?(t.$message({type:"success",message:e.msg}),setTimeout(function(){t.getList(t.currentPage)},500)):t.$message({type:"warning",message:e.msg?e.msg:"出错了"})})}})},deleteClass:function(t){var e=this;this.$confirm("此操作将删除该栏目, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={tokenId:e.$store.state.user.tokenId,id:t};e.$post("column/delete",a).then(function(t){console.log(t),0==t.code?(e.$message({type:"success",message:"删除成功!"}),setTimeout(function(){e.getList()},1e3)):"1"==t.code?e.$message({type:"error",message:t.msg}):e.$message({type:"info",message:"删除失败!"})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},getList:function(t){var e=this;this.currentPage=t||1;var a={tokenId:this.$store.state.user.tokenId,limit:this.per_page,offset:this.currentPage,queryField:this.columnName,navigationBar:2==this.navigationBar?"":this.navigationBar};this.$get("column/list",a).then(function(t){0==t.code&&(e.tableData=t.data[0].rows,e.loading=!1,e.total_pages=t.data[0].total)})},beforeClose:function(){this.newDialog=!1,this.fileList=[],this.$refs.classForm.resetFields(),this.isEdit=!1,this.classForm={title:"",enabled:"1",navigation_bar:"0"}},handleCurrentChange:function(t){this.getList(t)},handlePictureCardPreview:function(t){console.log(t),this.dialogImageUrl=t.url,this.imgDialog=!0},fileChange:function(t,e){this.$refs.icon.clearValidate(),this.classForm.filename=t.name,this.hasChangeFile=!0,this.classForm.file=t.raw,console.log(t.raw),e.length>0&&(this.hasFmt=!0)},handleExceed:function(t,e){this.$message.warning("当前限制选择 1 个文件")},handleRemove:function(t,e){this.pictureId="",this.hasChangeFile=!0,0==e.length&&(this.hasFmt=!1,this.classForm.file="",this.classForm.filename="")},handleSizeChange:function(t){this.per_page=t,this.getList()}},computed:{tableLength:function(){return this.tableData.length-1},upDataLength:function(){return this.upData.length-1}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-body rules"},[a("div",{staticClass:"breadcrumb",staticStyle:{padding:"8px"}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[t._v("系统设置")]),t._v(" "),a("el-breadcrumb-item",{attrs:{to:{path:"/rules-list"}}},[t._v("规则管理")]),t._v(" "),a("el-breadcrumb-item",[t._v("首页栏目管理")])],1)],1),t._v(" "),a("div",{staticClass:"page-header"},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"栏目推荐位置",size:"mini"},model:{value:t.navigationBar,callback:function(e){t.navigationBar=e},expression:"navigationBar"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{clearable:"",label:t.label,value:t.value}})})),t._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{size:"mini",placeholder:"请输入栏目名称"},model:{value:t.columnName,callback:function(e){t.columnName=e},expression:"columnName"}}),t._v(" "),a("el-button",{staticClass:"light_btn",on:{click:function(e){t.getList()}}},[t._v("搜索")])],1),t._v(" "),a("div",{staticClass:"box"},[a("div",{staticClass:"text-right marBo4"},[a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:function(e){t.$router.back()}}},[t._v("返回")]),t._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:t.publishWaitTop}},[t._v("栏目排序")]),t._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:function(e){t.newDialog=!0,t.classForm.title="",t.classForm.radio="1",t.isEdit=!1,t.hasChangeFile=!0}}},[a("i",{staticClass:"el-icon-plus",staticStyle:{"font-weight":"600"}}),t._v(" 栏目")]),t._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:function(e){t.getList()}}},[t._v("刷新")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":t.miniTable(),"header-row-class-name":t.miniTable(),data:t.tableData,stripe:"",border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"栏目名称"}}),t._v(" "),a("el-table-column",{attrs:{label:"icon",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.picture_url?a("img",{attrs:{src:e.row.picture_url,alt:""}}):a("p",[t._v("暂无图片")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"是否推荐到导航栏",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.navigation_bar?a("p",{staticClass:"yshx"},[t._v("已推荐")]):t._e(),t._v(" "),"0"==e.row.navigation_bar?a("p",[t._v("未推荐")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.enabled?a("p",{staticClass:"yshx"},[t._v("正常")]):t._e(),t._v(" "),"0"==e.row.enabled?a("p",{staticClass:"dshx"},[t._v("停用")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"修改时间",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){t.order(e.$index,e.row.id,3)}}},[a("i",{staticClass:"iconfont icon-Gototop"})]),t._v(" "),"0"==e.$index?a("el-button",{attrs:{type:"text",disabled:""}},[a("i",{staticClass:"iconfont icon-up"})]):a("el-button",{attrs:{type:"text"},on:{click:function(a){t.order(e.$index,e.row.id,1)}}},[a("i",{staticClass:"iconfont icon-up"})]),t._v(" "),e.$index!=t.tableLength?a("el-button",{attrs:{type:"text"},on:{click:function(a){t.order(e.$index,e.row.id,2)}}},[a("i",{staticClass:"iconfont icon-down"})]):a("el-button",{attrs:{type:"text",disabled:""}},[a("i",{staticClass:"iconfont icon-down"})]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){t.order(e.$index,e.row.id,4)}}},[a("i",{staticClass:"iconfont icon-Gotobottom"})]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){t.editClass(e.row)}}},[a("i",{staticClass:"iconfont icon-edit"})]),t._v(" "),a("el-button",{attrs:{type:"text"}},[a("i",{staticClass:"iconfont icon-delete",on:{click:function(a){t.deleteClass(e.row.id)}}})])]}}])})],1),t._v(" "),a("div",{staticClass:"marT20"},[a("el-pagination",{staticClass:"text-right",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1),t._v(" "),a("el-dialog",{attrs:{center:"","before-close":t.beforeClose,width:"30%","close-on-click-modal":!1,visible:t.newDialog,"append-to-body":""},on:{"update:visible":function(e){t.newDialog=e}}},[a("el-form",{ref:"classForm",staticClass:"classForm",attrs:{model:t.classForm,rules:t.classRules,"label-width":"110px"}},[a("el-form-item",{attrs:{label:"栏目标题",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"70%"},model:{value:t.classForm.name,callback:function(e){t.$set(t.classForm,"name",e)},expression:"classForm.name"}})],1),t._v(" "),a("el-form-item",{ref:"icon",attrs:{label:"上传icon","label-width":"110px",prop:"icon"}},[a("el-upload",{ref:"upload",attrs:{action:"",accept:"image/jpeg,image/gif,image/png,image/bmp",multiple:!1,limit:1,name:"file","list-type":"picture-card","file-list":t.fileList,"auto-upload":!1,"on-exceed":t.handleExceed,"on-preview":t.handlePictureCardPreview,"on-change":t.fileChange,"on-remove":t.handleRemove}},[a("i",{staticClass:"el-icon-plus"})]),t._v(" "),a("el-dialog",{attrs:{visible:t.imgDialog,modal:!1},on:{"update:visible":function(e){t.imgDialog=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"推荐到导航栏",required:""}},[a("el-radio",{attrs:{label:"1"},model:{value:t.classForm.navigation_bar,callback:function(e){t.$set(t.classForm,"navigation_bar",e)},expression:"classForm.navigation_bar"}},[t._v("是")]),t._v(" "),a("el-radio",{attrs:{label:"0"},model:{value:t.classForm.navigation_bar,callback:function(e){t.$set(t.classForm,"navigation_bar",e)},expression:"classForm.navigation_bar"}},[t._v("否")])],1),t._v(" "),a("el-form-item",{attrs:{label:"使用状态",required:""}},[a("el-radio",{attrs:{label:"1"},model:{value:t.classForm.enabled,callback:function(e){t.$set(t.classForm,"enabled",e)},expression:"classForm.enabled"}},[t._v("启用")]),t._v(" "),a("el-radio",{attrs:{label:"0"},model:{value:t.classForm.enabled,callback:function(e){t.$set(t.classForm,"enabled",e)},expression:"classForm.enabled"}},[t._v("关闭")])],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"light_btn",on:{click:function(e){t.beforeClose()}}},[t._v("取 消")]),t._v(" "),a("el-button",{staticClass:"light_btn",attrs:{type:"primary"},on:{click:t.createClass}},[t._v("保 存")])],1)],1),t._v(" "),a("el-dialog",{attrs:{center:"",title:"设置推荐栏目排序",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading2,expression:"loading2"}],staticStyle:{width:"100%"},attrs:{data:t.upData,border:"","row-class-name":t.btnTable,"header-row-class-name":t.btnTable}},[a("el-table-column",{attrs:{prop:"name",label:"栏目名称"}}),t._v(" "),a("el-table-column",{staticClass:"text-center",attrs:{prop:"name",label:"操作",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text"},on:{click:function(a){t.changeIndex(e.$index,t.upData,"toTop")}}},[a("i",{staticClass:"iconfont icon-Gototop"})]):a("el-button",{attrs:{type:"text",disabled:""}},[a("i",{staticClass:"iconfont icon-Gototop unclick"})]),t._v(" "),0!=e.$index?a("el-button",{attrs:{type:"text"},on:{click:function(a){t.changeIndex(e.$index,t.upData,"isUp")}}},[a("i",{staticClass:"iconfont icon-up"})]):a("el-button",{attrs:{type:"text",disabled:""}},[a("i",{staticClass:"iconfont icon-up unclick"})]),t._v(" "),e.$index!=t.upDataLength?a("el-button",{attrs:{type:"text"},on:{click:function(a){t.changeIndex(e.$index,t.upData,"isDown")}}},[a("i",{staticClass:"iconfont icon-down"})]):a("el-button",{attrs:{type:"text",disabled:""}},[a("i",{staticClass:"iconfont icon-down",staticStyle:{cursor:"not-allowed"}})]),t._v(" "),e.$index!=t.upDataLength?a("el-button",{attrs:{type:"text"},on:{click:function(a){t.changeIndex(e.$index,t.upData,"toBottom")}}},[a("i",{staticClass:"iconfont icon-Gotobottom"})]):a("el-button",{attrs:{type:"text",disabled:""}},[a("i",{staticClass:"iconfont icon-Gotobottom",staticStyle:{cursor:"not-allowed"}})])]}}])})],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.toPublish()}}},[t._v("发 布")])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(o,r,!1,function(t){a("V7Tz")},null,null);e.default=c.exports},V7Tz:function(t,e){}});
//# sourceMappingURL=43.952b6d39f4b372840fde.js.map