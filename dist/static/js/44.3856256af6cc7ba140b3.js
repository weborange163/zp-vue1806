webpackJsonp([44],{"75GW":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,s=a("bOdI"),i=a.n(s),o=a("TIfe"),r=a("RRt9"),n=(a("mtWM"),{components:{},data:function(){var e=this;return{fileList:[],imgFullSrc:"",imgSrc:"",videoUrl:"",videoId:"",showUrl:"",fileListVideo:[],hasChangeFile:!1,fabudao:"",form1:{title:"",content:"",column:"新闻资讯",sourceType:"1",source:"",status:"",author:"",userId:"1",imgType:"",newsFile:"",tagLabels:"",keyWords:"",coverImgId:""},classifyTypeAll:"",pkg:"",quill:{width:420,border:!0,height:150,zIndex:101,syncOutput:!0,theme:"snow",disabled:!1,full:!1,toolbar:[["bold","italic","underline","strike","link",{header:[1,2,3,4,5,6,!1]}],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],[{align:[!1,"right","center","justify"]}],["image","video"]]},bannerDialog:!1,idDetail:"",hasFmt:!0,uploadData:{},baceUrl:"",accounts:[],editorOption:{},dialogImageUrl:"",dialogVisible:!1,cities:[],argu:{},rules1:{icon:[{required:!0,validator:function(t,a,l){e.hasFmt?l():l(new Error("请上传封面图"))},trigger:"change"}],title:[{required:!0,validator:r.a.checkTitle,trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"change"},{pattern:/[0-9\u4e00-\u9fa5]+/g,message:"内容必须有中文或者数字",trigger:"blur"}],sourceType:[{required:!0,message:"请选择来源",trigger:"change"}],classifyType:[{required:!0,message:"请选择来源",trigger:"change"}],userId:[{required:!0,message:"请选择发布账号",trigger:"change"}],imgType:[{required:!0,message:"请选择图片",trigger:"change"}],source:[{required:!0,message:"请选择转载来源",trigger:"change"}],tagLabels:[{validator:function(e,t,a){""===t?a():t.replace(/，/gi,",").split(",").map(function(e){e.replace(/[^\x00-\xff]/g,"aa").length>12?a(new Error("单个tag标签不能超过12字节!")):a()})},trigger:"blur"}]}}},created:function(){this.baceUrl=Object(o.a)(),this.getParams(),this.videoUrl=this.baceUrl+"/news/addVideo",this.argu=this.$route.params.argu},mounted:function(){var e=this;this.$get("reprintSth/findAll",{tokenId:this.$store.state.user.tokenId}).then(function(t){e.cities=t.data}),this.$get("/industryCategory/findIndustryCategoryList",{tokenId:this.$store.state.user.tokenId}).then(function(t){e.classifyTypeAll=t.data}),this.$post("members/findByLevel",{tokenId:this.$store.state.user.tokenId,levelCode:100002}).then(function(t){e.accounts=t.data}),this.showNews()},methods:(l={radioChange:function(e){"2"==e?this.hasFmt=!0:this.fileList||(this.hasFmt=!1)},fileChange:function(e,t){this.$refs.icon.clearValidate(),this.form1.filename=e.name,this.form1.newsFile=e.raw,t.length>0&&(this.hasFmt=!0)},editNews:function(e,t){var a=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;if(console.log(e),"2"!=a.form1.sourceType||a.form1.source){if(2==a.form1.imgType){if(!a.form1.content.match(/src=/gi))return void a.$message.error("内容里没有图片!")}var l=new FormData;l.append("tokenId",a.$store.state.user.tokenId),l.append("id",a.form1.id),l.append("title",a.form1.title),l.append("content",a.form1.content),l.append("sourceType",a.form1.sourceType),l.append("author",a.form1.author),l.append("articleType",a.form1.articleType),l.append("classifyType",a.form1.classifyType),l.append("userId",a.form1.userId),l.append("imgType",a.form1.imgType),l.append("tagLabels",a.form1.tagLabels.replace(/，/gi,",")),l.append("publishSource","1"),l.append("status",t),a.videoId&&(l.append("videoId",a.videoId),l.append("videoUrl",a.showUrl)),"2"==a.form1.sourceType&&l.append("source",a.form1.source),"1"==a.form1.imgType&&a.hasChangeFile&&l.append("newsFile",a.form1.newsFile,a.form1.filename),a.$post("news/edit",l).then(function(e){if(0==e.code){a.$message({message:e.msg,type:"success"});var t="";t="新闻"==a.fabudao?"news":"market",setTimeout(function(){a.$router.push({name:t,params:{argu:a.argu}})},1e3)}})}else a.$message.error("请选择转载来源!")})},showNews:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,id:this.idDetail};this.$get("news/show",t).then(function(t){e.form1=t.data[0],"1"==e.form1.articleType?e.fabudao="新闻":e.fabudao="行情",e.showUrl=e.form1.videoUrl,e.form1.videoId&&(e.videoId=e.form1.videoId,e.showUrl=e.form1.videoUrl,e.fileListVideo.push({name:e.form1.videoName,url:e.form1.videoUrl})),e.imgSrc=e.form1.coverImgId,e.status=e.form1.status,e.imgFullSrc=e.form1.coverImgUrl,e.fileList.push({url:e.imgFullSrc})})},getParams:function(){var e=this.$route.params.id;this.idDetail=e},uploadImg:function(e,t){console.log(e);var a=new FormData;a.append("file",e,e.name),console.log(e.name),this.$post("images/upload",a).then(function(e){var a=e.data[0].showUrl;t(a,"center"),console.log(e)})},test:function(){console.log(this.form1.source)},onEditorBlur:function(e){e.quill,e.html,e.text}},i()(l,"onEditorBlur",function(e){}),i()(l,"onEditorFocus",function(e){console.log("editor focus!",e)}),i()(l,"onEditorReady",function(e){console.log("editor ready!",e)}),i()(l,"onEditorChange",function(e){var t=e.val;console.log("editor change!",t)}),i()(l,"handleExceed",function(e,t){this.$message.warning("当前限制选择 1 个文件")}),i()(l,"handleRemove",function(e,t){this.hasChangeFile=!0,console.log(e,t),0==t.length&&(this.hasFmt=!1)}),i()(l,"handlePictureCardPreview",function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0}),i()(l,"submitUpload",function(){this.$refs.uploadVideo.submit()}),i()(l,"handleRemove2",function(e,t){this.showUrl="",this.videoId=""}),i()(l,"handleSuccess",function(e,t){console.log(e.data[1]),this.showUrl=e.data[1],this.videoId=e.data[0],console.log(t)}),i()(l,"beforeRemove",function(e,t){return this.$confirm("确定移除 "+e.name+"？")}),i()(l,"fanhui",function(){var e=this;this.$confirm("返回已编辑内容将重置是否继续？").then(function(t){var a="";a="新闻"==e.fabudao?"news":"market",e.$router.push({name:a,params:{argu:e.argu}}),done()}).catch(function(e){})}),l),beforeRouteLeave:function(e,t,a){e.meta.keepAlive=!1,a()},watch:{$route:"getParams"}}),c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-body news_edit",staticStyle:{"min-width":"980px"}},[a("el-dialog",{attrs:{center:"",width:"30%",visible:e.bannerDialog,id:"div1","append-to-body":""},on:{"update:visible":function(t){e.bannerDialog=t}}},[a("el-form",{ref:"form1",staticClass:"form1",attrs:{data:e.form1,"label-width":"110px"}},[a("p",{attrs:{id:"p1"},domProps:{innerHTML:e._s(e.form1.title)}}),e._v(" "),a("p",{attrs:{id:"p2"},domProps:{innerHTML:e._s(e.form1.content)}})])],1),e._v(" "),a("div",{staticClass:"breadcrumb",staticStyle:{padding:"8px"}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("内容中心")]),e._v(" "),a("el-breadcrumb-item",[e._v("新闻信息")]),e._v(" "),a("el-breadcrumb-item",[e._v("编辑"+e._s(e.fabudao)+"资讯")])],1)],1),e._v(" "),a("div",{staticClass:"box"},[a("div",{staticClass:"text-right marR100"},[a("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:e.fanhui}},[e._v("返回")]),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.bannerDialog=!0}}},[e._v("预览")]),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.editNews("form1","0")}}},[e._v("保存")]),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.editNews("form1","1")}}},[e._v("保存并提交审核")])],1),e._v(" "),a("el-form",{ref:"form1",staticClass:"up_form clearfix",attrs:{model:e.form1,"label-width":"84px",rules:e.rules1}},[a("div",{staticStyle:{width:"48%",float:"left",padding:"15px","margin-left":"2%","margin-right":"5%"}},[a("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[a("el-input",{staticStyle:{width:"420px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入标题"},model:{value:e.form1.title,callback:function(t){e.$set(e.form1,"title",t)},expression:"form1.title"}})],1),e._v(" "),a("el-form-item",{staticClass:"editor",attrs:{label:"文章内容",prop:"content"}},[a("m-quill-editor",{ref:"myQuillEditor",attrs:{width:e.quill.width,getContent:e.onEditorChange,toolbar:e.quill.toolbar,"has-border":e.quill.border,zIndex:e.quill.zIndex,"sync-output":e.quill.syncOutput,theme:e.quill.theme,disabled:e.quill.disabled,fullscreen:e.quill.full},on:{upload:e.uploadImg,blur:function(t){e.onEditorBlur(t)}},model:{value:e.form1.content,callback:function(t){e.$set(e.form1,"content",t)},expression:"form1.content"}})],1)],1),e._v(" "),a("div",{staticStyle:{width:"35%",float:"left",padding:"15px","min-width":"420px"}},[a("el-form-item",{attrs:{label:"发布到:"}},[a("el-input",{attrs:{disabled:""},model:{value:e.fabudao,callback:function(t){e.fabudao=t},expression:"fabudao"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:"来源:",prop:"sourceType"}},[a("el-radio-group",{on:{change:function(t){e.test()}},model:{value:e.form1.sourceType,callback:function(t){e.$set(e.form1,"sourceType",t)},expression:"form1.sourceType"}},[a("el-radio",{attrs:{label:"1"}},[e._v("原创")]),e._v(" "),a("el-radio",{attrs:{label:"2"}},[e._v("转载")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[2==e.form1.sourceType?a("el-form-item",{attrs:{prop:"source"}},[a("el-select",{staticStyle:{"margin-left":"-68px",width:"150px"},attrs:{filterable:"",placeholder:"请选择转载来源"},model:{value:e.form1.source,callback:function(t){e.$set(e.form1,"source",t)},expression:"form1.source"}},e._l(e.cities,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1):e._e()],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"作者:"}},[a("el-input",{model:{value:e.form1.author,callback:function(t){e.$set(e.form1,"author",t)},expression:"form1.author"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"所属分类:",prop:"classifyType"}},[a("el-select",{staticStyle:{"padding-left":"6px"},attrs:{filterable:"",name:"classifyType",placeholder:"请选择"},model:{value:e.form1.classifyType,callback:function(t){e.$set(e.form1,"classifyType",t)},expression:"form1.classifyType"}},e._l(e.classifyTypeAll,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"发布账号:",prop:"userId"}},[a("el-select",{attrs:{filterable:""},model:{value:e.form1.userId,callback:function(t){e.$set(e.form1,"userId",t)},expression:"form1.userId"}},e._l(e.accounts,function(e){return a("el-option",{key:e.userId,attrs:{label:e.nickName,value:e.userId}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"附加选项:",prop:"imgType"}},[a("el-radio-group",{on:{change:e.radioChange},model:{value:e.form1.imgType,callback:function(t){e.$set(e.form1,"imgType",t)},expression:"form1.imgType"}},[a("el-radio",{attrs:{label:"1"}},[e._v("上传缩略图")]),e._v(" "),a("el-radio",{attrs:{label:"2"}},[e._v("提取第一个图为缩略图")])],1)],1),e._v(" "),"1"==e.form1.imgType?a("el-form-item",{ref:"icon",attrs:{prop:"icon",label:"封面图"}},[a("el-upload",{ref:"upload",attrs:{action:"",multiple:!1,limit:1,name:"newsFile","file-list":e.fileList,"list-type":"picture-card","auto-upload":!1,"on-change":e.fileChange,"on-exceed":e.handleExceed,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"上传视频:"}},[a("el-upload",{ref:"uploadVideo",staticClass:"upload-demo",attrs:{limit:1,name:"newsVideo",action:e.videoUrl,accept:"video/mp4","on-remove":e.handleRemove2,"file-list":e.fileListVideo,"on-success":e.handleSuccess,"before-remove":e.beforeRemove,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")]),e._v(" "),a("div",{staticClass:"el-upload__tip",domProps:{innerHTML:e._s(e.showUrl)}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Tag标签:",prop:"tagLabels"}},[a("el-input",{attrs:{placeholder:"用'，'隔开，单个标签小于12字节"},model:{value:e.form1.tagLabels,callback:function(t){e.$set(e.form1,"tagLabels",t)},expression:"form1.tagLabels"}})],1),e._v(" "),a("div",{staticClass:"tableOverstyle"},[a("table",{staticClass:"el-table el-table__body el-table--border",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("colgroup",[a("col",{attrs:{name:"el-table_1_column_1",width:"25%"}}),e._v(" "),a("col",{attrs:{name:"el-table_1_column_2",width:"75%"}})]),e._v(" "),a("tbody",[a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("发布来源")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},["1"==e.form1.publishSource?a("span",[e._v("PC后台")]):e._e(),"2"==e.form1.publishSource?a("span",[e._v("数据爬取")]):e._e(),"3"==e.form1.publishSource?a("span",[e._v("APP端")]):e._e()])])]),e._v(" "),a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("文章ID")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.articleId))])])]),e._v(" "),a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("状态")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},["0"==e.form1.status?a("span",[e._v("新建")]):e._e(),"1"==e.form1.status?a("span",[e._v("待审核")]):e._e(),"3"==e.form1.status?a("span",[e._v("审核中")]):e._e(),e._v(" "),"4"==e.form1.status?a("span",[e._v("已上线")]):e._e(),"5"==e.form1.status?a("span",[e._v("已下线")]):e._e()])])])])]),e._v(" "),a("table",{staticClass:"el-table el-table__body el-table--border marT20",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("colgroup",[a("col",{attrs:{name:"el-table_1_column_1"}}),e._v(" "),a("col",{attrs:{name:"el-table_1_column_1"}}),e._v(" "),a("col",{attrs:{name:"el-table_1_column_1"}}),e._v(" "),a("col",{attrs:{name:"el-table_1_column_2"}})]),e._v(" "),a("tbody",[a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"})]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v("时间")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v("操作账号")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v("备注")])])]),e._v(" "),a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("创建时间")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.createTime))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.createUser))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"})])]),e._v(" "),a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("上线时间")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.onlineTime))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.onlineUser))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"})])]),e._v(" "),a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("下线时间")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.offlineTime))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.offlineUser))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"})])]),e._v(" "),a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("修改时间")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.updateTime))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.updateUser))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"})])]),e._v(" "),a("tr",{staticClass:"el-table__row"},[a("td",[a("div",{staticClass:"cell"},[e._v("审核时间")])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.checkTime))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s("涉及敏感词"==e.form1.checkReason?"机审":e.form1.checkPerson))])]),e._v(" "),a("td",[a("div",{staticClass:"cell"},[e._v(e._s(e.form1.checkReason))])])])])])])],1)])],1)],1)},staticRenderFns:[]};var d=a("VU/8")(n,c,!1,function(e){a("HckU")},null,null);t.default=d.exports},HckU:function(e,t){}});
//# sourceMappingURL=44.3856256af6cc7ba140b3.js.map