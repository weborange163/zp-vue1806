webpackJsonp([35],{FYny:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("rx7x"),i=s("TIfe"),l={data:function(){var t=this;return{hasChangeFile:!1,fileList:[],isEdit:!1,editId:"",newDialog:!1,imgDialog:!1,dialogImageUrl:"",loading:!1,baceUrl:"",miniTable:a.miniTable,per_page:10,total_pages:0,currentPage:1,tableData:[],input:"",classForm:{title:"",radio:"1"},classRules:{title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:2,max:4,message:"长度在 2 到 4 个字",trigger:"blur"}],icon:[{required:!0,validator:function(e,s,a){t.hasFmt?a():a(new Error("请上传图片"))},trigger:"change"}]},hasFmt:!1}},created:function(){this.baceUrl=Object(i.a)(),this.getList()},computed:{tableLength:function(){return this.tableData.length-1}},methods:{order:function(t,e,s){var a=this,i={};i=1==s?{tokenId:this.$store.state.user.tokenId,firstId:this.tableData[t-1].id,lastId:e}:{tokenId:this.$store.state.user.tokenId,firstId:e,lastId:this.tableData[t+1].id},console.log(i),this.$post("industryCategory/updateByOrder",i).then(function(t){console.log(t),0==t.code&&(a.$message({type:"success",message:t.msg}),a.getList())})},editClass:function(t){console.log(t),this.newDialog=!0,this.classForm.title=t.name,this.classForm.radio=t.status,this.fileList.push({url:t.picture_url}),this.hasFmt=!0,this.editId=t.id,this.isEdit=!0},createClass:function(){var t=this;this.$refs.classForm.validate(function(e){if(e){var s=new FormData;s.append("tokenId",t.$store.state.user.tokenId),s.append("name",t.classForm.title),s.append("status",t.classForm.radio),t.isEdit&&s.append("id",t.editId),t.hasChangeFile&&s.append("newsFile",t.classForm.file,t.classForm.filename),t.$post("industryCategory/save",s).then(function(e){console.log(e),t.newDialog=!1,t.$refs.upload.clearFiles(),t.$refs.classForm.resetFields(),t.classForm.radio="1",t.fileList=[],0==e.code?(t.$message({type:"success",message:e.msg}),setTimeout(function(){t.getList()},500)):t.$message({type:"warning",message:e.msg?e.msg:"出错了"})})}})},deleteClass:function(t){var e=this;this.$confirm("此操作将删除该分类, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s={tokenId:e.$store.state.user.tokenId,status:0,id:t};e.$post("industryCategory/delete",s).then(function(t){console.log(t),0==t.code?(e.$message({type:"success",message:"删除成功!"}),setTimeout(function(){e.getList()},1e3)):"1"==t.code?e.$message({type:"error",message:t.msg}):e.$message({type:"info",message:"删除失败!"})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},getList:function(){var t=this;this.loading=!0;var e={tokenId:this.$store.state.user.tokenId,limit:this.per_page,offset:this.currentPage};this.$get("industryCategory/list",e).then(function(e){console.log(e),0==e.code&&(t.tableData=e.data[0].rows,t.loading=!1,t.total_pages=e.data[0].total)})},beforeClose:function(){this.newDialog=!1,this.fileList=[],this.isEdit=!1,this.classForm={title:"",radio:"1"}},handleCurrentChange:function(t){this.currentPage=t,this.getList()},handlePictureCardPreview:function(t){console.log(t),this.dialogImageUrl=t.url,this.imgDialog=!0},fileChange:function(t,e){this.$refs.icon.clearValidate(),this.classForm.filename=t.name,this.classForm.file=t.raw,console.log(t.raw),e.length>0&&(this.hasFmt=!0)},handleExceed:function(t,e){this.$message.warning("当前限制选择 1 个文件")},handleRemove:function(t,e){this.hasChangeFile=!0,0==e.length&&(this.hasFmt=!1)}}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-body rules"},[s("div",{staticClass:"page-header"}),t._v(" "),s("div",{staticClass:"box"},[s("div",{staticClass:"text-right marBo4"},[s("el-button",{staticClass:"light_btn",on:{click:function(e){t.newDialog=!0,t.classForm.title="",t.classForm.radio="1"}}},[t._v("新建分类")])],1),t._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":t.miniTable(),"header-row-class-name":t.miniTable(),data:t.tableData,stripe:"",border:""}},[s("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),t._v(" "),s("el-table-column",{attrs:{prop:"name",label:"分类名称"}}),t._v(" "),s("el-table-column",{attrs:{label:"icon",width:"100"},scopedSlots:t._u([{key:"default",fn:function(t){return[s("img",{attrs:{src:t.row.picture_url,alt:""}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.status?s("p",{staticClass:"yshx"},[t._v("正常")]):t._e(),t._v(" "),"2"==e.row.status?s("p",{staticClass:"dshx"},[t._v("停用")]):t._e(),t._v(" "),"3"==e.row.status?s("p",{staticClass:"yxx"},[t._v("启用")]):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"180"}}),t._v(" "),s("el-table-column",{attrs:{prop:"update_time",label:"修改时间",width:"180"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作",width:"260",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"==e.$index?s("el-button",{attrs:{type:"text",disabled:""}},[s("i",{staticClass:"iconfont icon-up"})]):s("el-button",{attrs:{type:"text"},on:{click:function(s){t.order(e.$index,e.row.id,1)}}},[s("i",{staticClass:"iconfont icon-up"})]),t._v(" "),e.$index!=t.tableLength?s("el-button",{attrs:{type:"text"},on:{click:function(s){t.order(e.$index,e.row.id,2)}}},[s("i",{staticClass:"iconfont icon-down"})]):s("el-button",{attrs:{type:"text",disabled:""}},[s("i",{staticClass:"iconfont icon-down"})]),t._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){t.editClass(e.row)}}},[s("i",{staticClass:"iconfont icon-edit"})]),t._v(" "),s("el-button",{attrs:{type:"text"}},[s("i",{staticClass:"iconfont icon-delete",on:{click:function(s){t.deleteClass(e.row.id)}}})])]}}])})],1),t._v(" "),s("div",{staticClass:"marT20"},[s("el-pagination",{staticClass:"text-right",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"prev, pager, next",total:this.total_pages},on:{"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),s("el-dialog",{attrs:{center:"","before-close":t.beforeClose,width:"30%","close-on-click-modal":!1,visible:t.newDialog,"append-to-body":""},on:{"update:visible":function(e){t.newDialog=e}}},[s("el-form",{ref:"classForm",staticClass:"classForm",attrs:{model:t.classForm,rules:t.classRules,"label-width":"110px"}},[s("el-form-item",{attrs:{label:"分类标题",prop:"title",size:"mini"}},[s("el-input",{staticStyle:{width:"70%"},model:{value:t.classForm.title,callback:function(e){t.$set(t.classForm,"title",e)},expression:"classForm.title"}})],1),t._v(" "),s("el-form-item",{ref:"icon",attrs:{label:"上传icon","label-width":"110px",prop:"icon"}},[s("el-upload",{ref:"upload",attrs:{action:"",multiple:!1,limit:1,name:"file","list-type":"picture-card","file-list":t.fileList,"auto-upload":!1,"on-exceed":t.handleExceed,"on-preview":t.handlePictureCardPreview,"on-change":t.fileChange,"on-remove":t.handleRemove}},[s("i",{staticClass:"el-icon-plus"})]),t._v(" "),s("el-dialog",{attrs:{visible:t.imgDialog},on:{"update:visible":function(e){t.imgDialog=e}}},[s("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),s("el-form-item",{attrs:{label:"使用状态",required:""}},[s("el-radio",{attrs:{label:"1"},model:{value:t.classForm.radio,callback:function(e){t.$set(t.classForm,"radio",e)},expression:"classForm.radio"}},[t._v("启用")]),t._v(" "),s("el-radio",{attrs:{label:"2"},model:{value:t.classForm.radio,callback:function(e){t.$set(t.classForm,"radio",e)},expression:"classForm.radio"}},[t._v("关闭")])],1)],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"light_btn",on:{click:function(e){t.beforeClose()}}},[t._v("取 消")]),t._v(" "),s("el-button",{staticClass:"light_btn",attrs:{type:"primary"},on:{click:t.createClass}},[t._v("保 存")])],1)],1)],1)},staticRenderFns:[]};var n=s("VU/8")(l,o,!1,function(t){s("ycti")},null,null);e.default=n.exports},ycti:function(t,e){}});
//# sourceMappingURL=35.4a2aa79bd8281a049d40.js.map