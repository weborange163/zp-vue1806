webpackJsonp([20],{AU1N:function(t,e){},cdnN:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("TIfe"),s={data:function(){var t=this;return{filterBag:"",filterCode:"",loading2:!1,idDetail:"",per_page:10,total_pages:0,currentPage:1,currentPage_bidding:7,plugData:[],content:"111",bag:{},fileList:[],newDialog:!1,hasFmt:!1,imgDialog:!1,dialogImageUrl:"",plugForm:{radio:"0"},plugRules:{icon:[{required:!0,validator:function(e,a,l){t.hasFmt?l():l(new Error("请上传插件包!"))},trigger:"change"}],num:[{required:!0,message:"请输入版本号",trigger:"blur"},{pattern:/^[a-zA-Z0-9.]+$/,message:"只允许输入英文数字和.",trigger:"blur"}],plugcode:[{required:!0,message:"请输入code版本",trigger:"blur"},{pattern:/^[0-9]*$/,message:"code版本只能输入数字",trigger:"blur"}],plugname:[{required:!0,message:"请输入插件名称",trigger:"blur"}],plugPackageName:[{required:!0,message:"请输入插件包名",trigger:"blur"}],desc:[{required:!0,message:"请输入插件提示",trigger:"blur"}]},app_id:"",isEdit:!1,editId:"",baceUrl:""}},created:function(){this.baceUrl=Object(l.a)(),this.getParams(),this.getInfo(),this.getPlugList(),console.log(this.idDetail)},methods:{getParams:function(){var t=this.$route.params.id;this.idDetail=t,console.log(this.$route.params)},miniTable:function(t){return"miniTable"},downPlug:function(t){var e=this;this.$confirm("确定要下载此插件包吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){window.location.href=t}).catch(function(){e.$message({type:"info",message:"已取消下载"})})},onOff:function(t,e){var a=this,l="";l="2"==t?"上线":"下线",this.$confirm("确定要"+l+"当前插件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){var l={tokenId:a.$store.state.user.tokenId,status:t,id:e};a.$post("pluginUpgrade/onAndOffLine",l).then(function(t){console.log(t),0==t.code&&(setTimeout(function(){a.getPlugList()},500),a.$message({type:"success",message:t.msg}))})}).catch(function(){a.$message({type:"info",message:"已取消操作"})})},deletePlug:function(t){var e=this;this.$confirm("此操作将删除该插件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={tokenId:e.$store.state.user.tokenId,status:0,id:t};e.$post("pluginUpgrade/delete",a).then(function(t){console.log(t),0==t.code?(e.$message({type:"success",message:"删除成功!"}),setTimeout(function(){e.getPlugList()},1e3)):e.$message({type:"info",message:"删除失败!"})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},editPlug:function(t){this.newDialog=!0,this.fileList.push({url:t.download_url,name:t.file_name}),this.plugForm.num=t.version_name,this.plugForm.plugcode=t.version_code,this.plugForm.plugname=t.plugin_name,this.plugForm.desc=t.upgrade_content,this.plugForm.plugPackageName=t.package_name,this.plugForm.radio=t.upgrade_mode,this.plugForm.id=t.id,this.isEdit=!0,this.editId=t.id,this.hasFmt=!0,console.log(this.fileList),console.log(this.plugForm.file)},beforeClose:function(){var t=this;this.$confirm("关闭后输入的信息将重置!").then(function(){t.$refs.plugForm.resetFields(),t.fileList=[],t.isEdit=!1,t.newDialog=!1,t.plugForm={radio:"0"},done()}).catch(function(){})},getInfo:function(){var t=this,e={tokenId:this.$store.state.user.tokenId,id:this.idDetail};this.$post("appUpgrade/get",e).then(function(e){if(console.log(e),0==e.code){console.log(e.data[0]);var a=e.data[0].appUpgrade;t.bag=e.data[0].appUpgrade,"1"==a.status?t.bag.status1="新建":"2"==a.status?t.bag.status1="已上线":t.bag.status1="已下线","1"==a.platformType?t.bag.platformType1="安卓":t.bag.platformType1="IOS","0"==a.upgradeMode?t.bag.upgradeMode1="可选升级":t.bag.upgradeMode1="强制升级"}})},createPlug:function(){var t=this;this.$refs.plugForm.validate(function(e){if(e){t.loading2=!0;var a=new FormData;a.append("tokenId",t.$store.state.user.tokenId),a.append("appId",t.idDetail),a.append("versionName",t.plugForm.num),a.append("versionCode",t.plugForm.plugcode),a.append("upgradeContent",t.plugForm.desc),a.append("upgradeMode",t.plugForm.radio),a.append("newsFile",t.plugForm.file,t.plugForm.filename),a.append("packageName",t.plugForm.plugPackageName),a.append("pluginName",t.plugForm.plugname),t.isEdit&&(console.log(1111),a.append("id",t.editId)),console.log(t.idDetail),t.$post("pluginUpgrade/save",a).then(function(e){console.log(e),t.loading2=!1,0==e.code?(t.$refs.upload.clearFiles(),t.$refs.plugForm.resetFields(),t.plugForm={},t.fileList=[],t.hasFmt=!1,t.newDialog=!1,t.$message({type:"success",message:e.msg}),setTimeout(function(){t.getPlugList()},500)):t.$message({type:"error",message:e.msg})})}})},getPlugList:function(){var t=this,e={tokenId:this.$store.state.user.tokenId,appId:this.idDetail,limit:this.per_page,offset:this.currentPage,packageName:this.filterBag,versionCode:this.filterCode};this.$post("pluginUpgrade/list",e).then(function(e){console.log(e),t.plugData=e.data[0].rows,t.total_pages=e.data[0].total})},handleCurrentChange:function(t){this.currentPage=t,this.getPlugList()},handleSizeChange:function(t){this.per_page=t,this.getPlugList()},handlePictureCardPreview:function(t){console.log(t),this.dialogImageUrl=t.url,this.imgDialog=!0},fileChange:function(t,e){this.$refs.icon.clearValidate(),this.plugForm.filename=t.name,this.plugForm.file=t.raw,console.log(t.name),console.log(t.raw),e.length>0&&(this.hasFmt=!0)},handleExceed:function(t,e){this.$message.warning("当前限制选择 1 个文件")},handleRemove:function(t,e){console.log(t,e),0==e.length&&(this.hasFmt=!1)}},watch:{$route:"getParams"}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"version-list"},[a("el-breadcrumb",{staticStyle:{"margin-top":"8px","margin-bottom":"8px","margin-left":"22px"},attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[t._v("系统管理")]),t._v(" "),a("el-breadcrumb-item",[t._v("版本管理")]),t._v(" "),a("el-breadcrumb-item",[t._v("应用详情")])],1),t._v(" "),a("div",{staticStyle:{"margin-left":"22px","margin-right":"22px","margin-bottom":"20px",overflow:"hidden",background:"rgba(255,255,255,1)","border-radius":"4px","box-shadow":"0px 0px 0px rgba(54,88,167,0.07)"}},[a("div",{staticStyle:{"margin-top":"20px","margin-right":"88px","text-align":"right"}},[a("router-link",{attrs:{to:{name:"version"}}},[a("el-button",{staticClass:"light_btn router_btn",attrs:{size:"small"}},[t._v("返回")])],1),t._v(" "),"1"==t.bag.platformType?a("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(e){t.newDialog=!0,t.isEdit=!1}}},[t._v("上传插件")]):t._e()],1),t._v(" "),a("p",{staticClass:"title-p"},[t._v("应用信息")]),t._v(" "),a("div",{staticClass:"el-table__body-wrapper is-scrolling-none info_table"},[a("table",{staticClass:"el-table el-table__body el-table--border",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[t._m(0),t._v(" "),a("tbody",[a("tr",{staticClass:"el-table__row"},[t._m(1),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.packageName))])]),t._v(" "),t._m(2),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.versionName))])])]),t._v(" "),a("tr",{staticClass:"el-table__row"},[t._m(3),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.downloadUrl))])]),t._v(" "),t._m(4),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.versionCode))])])]),t._v(" "),a("tr",{staticClass:"el-table__row"},[t._m(5),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.fileMdFive))])]),t._v(" "),t._m(6),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.fileSize))])])]),t._v(" "),a("tr",{staticClass:"el-table__row"},[t._m(7),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.upgradeMode1))])]),t._v(" "),t._m(8),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.platformType1))])])]),t._v(" "),a("tr",{staticClass:"el-table__row"},[t._m(9),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.status1))])]),t._v(" "),t._m(10),t._v(" "),a("td",{attrs:{rowspan:"2"}},[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.upgradeContent))])])]),t._v(" "),a("tr",{staticClass:"el-table__row"},[t._m(11),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.delayTime))])])]),t._v(" "),a("tr",{staticClass:"el-table__row"},[t._m(12),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.createTime))])]),t._v(" "),t._m(13),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.updateTime))])])]),t._v(" "),a("tr",{staticClass:"el-table__row"},[t._m(14),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.onlineTime))])]),t._v(" "),t._m(15),t._v(" "),a("td",[a("div",{staticClass:"cell"},[t._v(t._s(t.bag.updateUserId))])])])])])]),t._v(" "),"1"==t.bag.platformType?a("p",{staticClass:"title-p"},[t._v("插件信息")]):t._e(),t._v(" "),"1"==t.bag.platformType?a("div",{staticStyle:{"margin-bottom":"10px"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",placeholder:"请输入包名"},model:{value:t.filterBag,callback:function(e){t.filterBag=e},expression:"filterBag"}}),t._v(" "),a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",placeholder:"请输入code版本"},model:{value:t.filterCode,callback:function(e){t.filterCode=e},expression:"filterCode"}}),t._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:t.getPlugList}},[t._v("搜 索")])],1):t._e(),t._v(" "),"1"==t.bag.platformType?a("el-table",{attrs:{data:t.plugData,"row-class-name":t.miniTable,"header-row-class-name":t.miniTable,border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"version_code",label:"版本号",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"plugin_name",label:"插件名称",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"package_name",label:"插件包名",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"download_url",label:"下载地址"}}),t._v(" "),a("el-table-column",{attrs:{prop:"file_size",label:"插件大小",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"修改时间",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{label:"状态",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.status?a("p",{staticClass:"dshx"},[t._v("新建")]):t._e(),t._v(" "),"2"==e.row.status?a("p",{staticClass:"yshx"},[t._v("已上线")]):t._e(),t._v(" "),"3"==e.row.status?a("p",{staticClass:"yyx"},[t._v("已下线")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"marR10",attrs:{type:"text"},on:{click:function(a){t.downPlug(e.row.download_url)}}},[t._v("下载")]),t._v(" "),a("router-link",{attrs:{to:{name:"version-detail",params:{id:e.row.id}}}},[a("el-button",{staticClass:"marR10",attrs:{type:"text"}},[t._v("查看")])],1),t._v(" "),"2"==e.row.status?a("el-button",{staticClass:"marR10",attrs:{type:"text"},on:{click:function(a){t.onOff("3",e.row.id)}}},[t._v("下线")]):a("el-button",{staticClass:"marR10",attrs:{type:"text"},on:{click:function(a){t.onOff("2",e.row.id)}}},[t._v("上线")]),t._v(" "),"1"==e.row.status?a("el-button",{staticClass:"marR10",attrs:{type:"text"},on:{click:function(a){t.editPlug(e.row)}}},[a("i",{staticClass:"iconfont icon-edit"})]):t._e(),t._v(" "),"2"!=e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){t.deletePlug(e.row.id)}}},[a("i",{staticClass:"iconfont icon-delete"})]):a("el-button",{attrs:{type:"text",disabled:""}},[a("i",{staticClass:"iconfont icon-delete"})])]}}])})],1):t._e(),t._v(" "),"1"==t.bag.platformType?a("div",{staticClass:"marT20"},[a("el-pagination",{staticClass:"text-right",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1):t._e()],1),t._v(" "),a("el-dialog",{attrs:{center:"","close-on-click-modal":!1,width:"30%","before-close":t.beforeClose,visible:t.newDialog,"append-to-body":""},on:{"update:visible":function(e){t.newDialog=e}}},[a("el-form",{ref:"plugForm",staticClass:"plugForm",attrs:{model:t.plugForm,rules:t.plugRules,"label-width":"110px"}},[a("el-form-item",{ref:"icon",attrs:{label:"上传插件包","label-width":"110px",prop:"icon"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"",multiple:!1,limit:1,name:"file","file-list":t.fileList,"auto-upload":!1,"on-exceed":t.handleExceed,"on-preview":t.handlePictureCardPreview,"on-change":t.fileChange,"on-remove":t.handleRemove}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1),t._v(" "),a("el-dialog",{attrs:{visible:t.imgDialog},on:{"update:visible":function(e){t.imgDialog=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"版本号",prop:"num"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:t.plugForm.num,callback:function(e){t.$set(t.plugForm,"num",e)},expression:"plugForm.num"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"code版本",prop:"plugcode"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:t.plugForm.plugcode,callback:function(e){t.$set(t.plugForm,"plugcode",e)},expression:"plugForm.plugcode"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"插件包名",prop:"plugPackageName"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:t.plugForm.plugPackageName,callback:function(e){t.$set(t.plugForm,"plugPackageName",e)},expression:"plugForm.plugPackageName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"插件名称",prop:"plugname"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{size:"mini"},model:{value:t.plugForm.plugname,callback:function(e){t.$set(t.plugForm,"plugname",e)},expression:"plugForm.plugname"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"插件提示",prop:"desc"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{type:"textarea"},model:{value:t.plugForm.desc,callback:function(e){t.$set(t.plugForm,"desc",e)},expression:"plugForm.desc"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"升级模式",required:""}},[a("el-radio",{attrs:{label:"0"},model:{value:t.plugForm.radio,callback:function(e){t.$set(t.plugForm,"radio",e)},expression:"plugForm.radio"}},[t._v("可选升级")]),t._v(" "),a("el-radio",{attrs:{label:"1"},model:{value:t.plugForm.radio,callback:function(e){t.$set(t.plugForm,"radio",e)},expression:"plugForm.radio"}},[t._v("强制升级")])],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"light_btn",on:{click:t.beforeClose}},[t._v("取 消")]),t._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading2,expression:"loading2",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"light_btn",attrs:{type:"primary","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"},on:{click:t.createPlug}},[t._v("保 存")])],1)],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("colgroup",[e("col",{attrs:{name:"el-table_1_column_1",width:"15%"}}),this._v(" "),e("col",{attrs:{name:"el-table_1_column_2",width:"35%"}}),this._v(" "),e("col",{attrs:{name:"el-table_1_column_3",width:"15%"}}),this._v(" "),e("col",{attrs:{name:"el-table_1_column_4",width:"35%"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("应用包名")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("版本号")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("下载地址")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("code版本")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("MD5")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("应用大小")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("升级模式")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("应用平台")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("状态")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",{attrs:{rowspan:"2"}},[e("div",{staticClass:"cell"},[this._v("版本提示")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("延时生效")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("创建时间")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("修改时间")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("更新时间")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("td",[e("div",{staticClass:"cell"},[this._v("操作人")])])}]};var o=a("VU/8")(s,i,!1,function(t){a("AU1N")},null,null);e.default=o.exports}});
//# sourceMappingURL=20.ae1d0b20ba5909658961.js.map