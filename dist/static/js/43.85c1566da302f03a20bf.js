webpackJsonp([43],{OEpR:function(e,t){},avxo:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={data:function(){return{isEdit:!1,newsFile:"",formDatas:"",fileList:[],radio:"100001",checkOp:[],checkList:[],form:{phone:"",nickName:"",userDesc:"",identityCode:"",rankCode:"1001",sex:1,birthday:"",provinceId:"",cityId:""},provinceArr:[],cityArr:[],provinceVal:"",cityVal:"",identityValue:[],identitySelect:[{value:"100000",label:"普通会员"},{value:"100001",label:"认证会员"},{value:"100002",label:"内部小号"},{value:"100003",label:"内部大号"}],rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^[0-9]*$/,message:"手机号只能输入数字",trigger:"blur"},{min:4,max:12,message:"长度在 4 到 12 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:15,message:"长度在 4 到 15 个字符",trigger:"blur"}],identityCode:[{required:!0,message:"请选择账号类型",trigger:"blur"}],userDesc:[{min:1,max:25,message:"长度在 1 到 25 个字符",trigger:"blur"}],rankCode:[{required:!0,message:"请选择是否加V",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"blur"}]},innerMemDia:!1,identityDia:!1,powerDia:!1,loading:!1,per_page:10,total_pages:0,currentPage:1,tableData:[],options:[{value:"0",label:"全部"},{value:"registTime",label:"注册时间"},{value:"loginTime",label:"最后登录时间"}],options1:[{value:"0",label:"全部"},{value:"1",label:"男"},{value:"2",label:"女"}],value:"",value1:"",value2:"",value3:"",value4:"",value5:"",value6:"",userId:""}},created:function(){var e=this;this.showList(),this.$post("/area/findProvince",{tokenId:this.$store.state.user.tokenId}).then(function(t){e.provinceArr=t.data})},methods:{editInner:function(e){var t=this;this.isEdit=!0;var a={tokenId:this.$store.state.user.tokenId,userId:e};this.$post("/members/getBaseInfo",a).then(function(e){console.log(e.data[0]),t.form=e.data[0],t.innerMemDia=!0,t.form.provinceId&&t.$post("/area/findCityByProvinceNo",{tokenId:t.$store.state.user.tokenId,areaNo:t.form.provinceId}).then(function(e){t.cityArr=e.data})})},sureUpload:function(){var e=this,t=this.$loading({lock:!0,text:"上传中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.5)"});this.formDatas=new FormData,this.formDatas.append("usersFile",this.newsFile),this.formDatas.append("tokenId",this.$store.state.user.tokenId),this.$post("/members/toExportInt",this.formDatas).then(function(a){0==a.code?(t.close(),e.$message({message:a.msg,type:"success"}),e.showList()):(t.close(),e.$message({message:a.msg?a.msg:"操作失败",type:"error"}))})},handleChange:function(e,t){var a=this;this.newsFile=e.raw,this.fileList=t,this.$confirm("确定要上传吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){a.sureUpload()}).catch(function(){a.$message({type:"info",message:"操作已取消"})})},handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},testVal:function(e){console.log(e)},showList:function(e){var t=this;this.loading=!0,this.currentPage=e||1;var a={tokenId:this.$store.state.user.tokenId,limit:this.per_page,offset:this.currentPage,queryType:this.value,sex:0==this.value3?"":this.value3,ageStart:this.value4,ageEnd:this.value5,simpleParameter:this.value6,identityCode:this.identityValue.join(","),provinceId:"000000"==this.provinceVal?"":this.provinceVal,cityId:this.cityVal};0==this.value&&(a.queryType="",a.startTime="",a.endTime=""),this.value2&&(a.startTime=this.value2[0],a.endTime=this.value2[1]),this.$post("members/list",a).then(function(e){if(0==e.code){var a=e.data[0].rows;a.map(function(e){e.addr=("未填写"==e.province?"未填写":e.province)+("未填写"==e.city?"":e.city)+("未填写"==e.area?"":e.area)}),t.tableData=a,t.total_pages=e.data[0].total,t.loading=!1}})},provinceChange:function(e){var t=this;this.cityVal="",e&&this.$post("/area/findCityByProvinceNo",{tokenId:this.$store.state.user.tokenId,areaNo:e}).then(function(e){t.cityArr=e.data})},provinceChange2:function(e){var t=this;console.log(e),this.form.cityId="",e&&this.$post("/area/findCityByProvinceNo",{tokenId:this.$store.state.user.tokenId,areaNo:e}).then(function(e){t.cityArr=e.data})},setIdentity:function(e,t){this.identityDia=!0,console.log(e,t),"1002"==t.rank_code?this.radio="1002":this.radio="1001",this.userId=t.userId},changeIdentity:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,rankCode:this.radio,userId:this.userId};this.$post("members/updateLevel",t).then(function(t){0==t.code&&(e.identityDia=!1,e.userId="",e.showList(),e.$message({message:t.msg,type:"success"}))})},setPower:function(e,t){var a=this;this.powerDia=!0,this.userId=t.userId,this.$post("members/prohibit/findList",{tokenId:this.$store.state.user.tokenId,status:"1"}).then(function(e){a.checkOp=e.data;var i={tokenId:a.$store.state.user.tokenId,userId:t.userId};a.$post("members/getPermissions",i).then(function(e){a.checkList=[],e.data[0]&&(a.checkList=e.data[0].prohibitCodes.split(","))})})},changePower:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,prohibitCodes:this.checkList.join(","),userId:this.userId};this.$post("members/setPermissions",t).then(function(t){console.log(t),0==t.code?(e.$message({message:t.msg,type:"success"}),e.powerDia=!1):e.$message({message:"设置失败请重试!",type:"error"})})},createInner:function(){var e=this;console.log(this.form.birthday),this.$refs.form.validate(function(t){if(t){var a={tokenId:e.$store.state.user.tokenId,phone:e.form.phone,nickName:e.form.nickName,userDesc:e.form.userDesc,identityCode:e.form.identityCode,rankCode:e.form.rankCode,sex:e.form.sex,birthday:e.form.birthday,provinceId:e.form.provinceId,cityId:e.form.cityId},i="/members/addInnerMember";e.isEdit&&(a.userId=e.form.userId,i="/members/updateInnerMember"),e.$post(i,a).then(function(t){0==t.code?(e.innerMemDia=!1,e.$message({message:t.msg,type:"success"}),e.showList(),e.form={}):e.$message({message:"添加失败请重试!",type:"error"})})}})},handleCurrentChange:function(e){this.showList(e)},handleSizeChange:function(e){this.per_page=e,this.showList()},tofilter:function(e){console.log(e),console.log(this.value)},handleInfo:function(e,t){console.log(e,t)},miniTable:function(e){return"miniTable"}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-body member"},[a("div",{staticClass:"page-header clearfix"},[a("el-row",[a("el-col",{attrs:{span:14}},[a("el-row",{staticStyle:{"margin-bottom":"8px"},attrs:{gutter:6}},[a("el-col",{attrs:{span:7}},[a("el-select",{attrs:{size:"mini",placeholder:"时间类型"},on:{change:e.tofilter},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"mini",type:"datetimerange","value-format":"yyyy-MM-dd HH-mm-ss","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","00:00:00"]},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}})],1)],1),e._v(" "),a("el-row",{attrs:{gutter:6}},[a("el-col",{attrs:{span:7}},[a("el-select",{attrs:{size:"mini",placeholder:"性别"},on:{change:e.tofilter},model:{value:e.value3,callback:function(t){e.value3=t},expression:"value3"}},e._l(e.options1,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{size:"mini",type:"number",placeholder:"请输入起始年龄"},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}})],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{size:"mini",type:"number",placeholder:"请输入结束年龄"},model:{value:e.value5,callback:function(t){e.value5=t},expression:"value5"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:10,offset:0}},[a("el-row",{staticStyle:{"margin-bottom":"8px"}},[a("el-select",{staticStyle:{width:"220px","margin-right":"2%"},attrs:{size:"mini",placeholder:"会员身份",filterable:"","default-first-option":"",multiple:"","allow-create":""},on:{change:e.testVal},model:{value:e.identityValue,callback:function(t){e.identityValue=t},expression:"identityValue"}},e._l(e.identitySelect,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-select",{staticStyle:{width:"150px","margin-right":"2%"},attrs:{size:"mini",placeholder:"选择省"},on:{change:e.provinceChange},model:{value:e.provinceVal,callback:function(t){e.provinceVal=t},expression:"provinceVal"}},e._l(e.provinceArr,function(e){return a("el-option",{key:e.areaNo,attrs:{label:e.areaName,value:e.areaNo}})})),e._v(" "),a("el-select",{staticStyle:{width:"130px"},attrs:{size:"mini",placeholder:"选择市"},model:{value:e.cityVal,callback:function(t){e.cityVal=t},expression:"cityVal"}},e._l(e.cityArr,function(e){return a("el-option",{key:e.areaNo,attrs:{label:e.areaName,value:e.areaNo}})}))],1),e._v(" "),a("el-row",{attrs:{gutter:6}},[a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{size:"mini",placeholder:"请输入用户名/用户ID/手机号"},model:{value:e.value6,callback:function(t){e.value6=t},expression:"value6"}})],1),e._v(" "),a("el-col",{attrs:{span:3}},[a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:function(t){e.showList()}}},[e._v("搜索")])],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"member_table"},[a("div",{staticClass:"text-right marBo4"},[a("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline"},attrs:{name:"usersFile",action:"","on-preview":e.handlePreview,"on-change":e.handleChange,"on-remove":e.handleRemove,"auto-upload":!1,"on-exceed":e.handleExceed,"file-list":e.fileList}},[a("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("批量上传内部号")])],1),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:function(t){e.innerMemDia=!0,e.isEdit=!1}}},[e._v("创建内部号")]),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{size:"mini"},on:{click:function(t){e.showList()}}},[e._v("刷新")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":e.miniTable,"header-row-class-name":e.miniTable,data:e.tableData,border:"",stripe:""}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"nickName",label:"用户名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"identity",label:"身份",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return["100001"==t.row.identity_code&&"1001"==t.row.rank_code?a("p",[e._v("普通会员")]):e._e(),e._v(" "),"100001"==t.row.identity_code&&"1002"==t.row.rank_code?a("p",[e._v("认证会员")]):e._e(),e._v(" "),"100002"==t.row.identity_code?a("p",[e._v("内部小号")]):e._e(),e._v(" "),"100003"==t.row.identity_code?a("p",[e._v("内部大号")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机号",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sex",label:"性别",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"age",width:"50",label:"年龄"}}),e._v(" "),a("el-table-column",{attrs:{prop:"addr",label:"城市",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"注册时间",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userCode",label:"会员ID",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{prop:"loginTime",label:"最后登录时间",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"124"},scopedSlots:e._u([{key:"default",fn:function(t){return["100001"==t.row.identity_code?a("div",[a("router-link",{attrs:{to:{name:"member-info",params:{id:t.row.userId}}}},[a("el-button",{attrs:{type:"text",size:"mini"}},[e._v("详情")])],1),e._v(" "),a("el-button",{staticClass:"marL10",attrs:{type:"text",size:"mini"},on:{click:function(a){e.setPower(t.$index,t.row)}}},[e._v("权限")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.setIdentity(t.$index,t.row)}}},[e._v("身份")])],1):a("div",[a("router-link",{attrs:{to:{name:"member-info",params:{id:t.row.userId}}}},[a("el-button",{attrs:{type:"text",size:"mini"}},[e._v("详情")])],1),e._v(" "),a("el-button",{staticClass:"marL10",attrs:{type:"text",size:"mini",disabled:""}},[e._v("权限")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.editInner(t.row.userId)}}},[e._v("编辑")])],1)]}}])})],1),e._v(" "),a("div",{staticClass:"marT20"},[a("el-pagination",{staticClass:"text-right",attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"创建内部账号",visible:e.innerMemDia,width:"600px",center:""},on:{"update:visible":function(t){e.innerMemDia=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"84px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"账号类型:",prop:"identityCode"}},[a("el-select",{attrs:{size:"mini",placeholder:"选择账号类型"},model:{value:e.form.identityCode,callback:function(t){e.$set(e.form,"identityCode",t)},expression:"form.identityCode"}},[a("el-option",{attrs:{value:"100002",label:"内部小号"}}),e._v(" "),a("el-option",{attrs:{value:"100003",label:"内部大号"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号:",prop:"phone"}},[a("el-input",{attrs:{"auto-complete":"off",size:"mini",placeholder:"请输入4-12位数字"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户名:",prop:"nickName"}},[a("el-input",{attrs:{size:"mini",placeholder:"请输入4-15个字"},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName","string"==typeof t?t.trim():t)},expression:"form.nickName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"简介:",prop:"userDesc"}},[a("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"请输入简介"},model:{value:e.form.userDesc,callback:function(t){e.$set(e.form,"userDesc",t)},expression:"form.userDesc"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"加V:",prop:"rankCode"}},[a("el-radio",{attrs:{label:"1002"},model:{value:e.form.rankCode,callback:function(t){e.$set(e.form,"rankCode",t)},expression:"form.rankCode"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"1001"},model:{value:e.form.rankCode,callback:function(t){e.$set(e.form,"rankCode",t)},expression:"form.rankCode"}},[e._v("否")])],1),e._v(" "),a("el-form-item",{attrs:{label:"性别:",prop:"sex"}},[a("el-radio",{attrs:{label:2},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[e._v("女")]),e._v(" "),a("el-radio",{attrs:{label:1},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[e._v("男")])],1),e._v(" "),a("el-form-item",{attrs:{label:"生日:",prop:"birthday"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"mini","value-format":"yyyy-MM-dd",type:"date",placeholder:"选择生日"},model:{value:e.form.birthday,callback:function(t){e.$set(e.form,"birthday",t)},expression:"form.birthday"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"城市:",prop:"add"}},[a("el-select",{staticStyle:{width:"45%","margin-right":"2%"},attrs:{size:"mini",placeholder:"选择省"},on:{change:e.provinceChange2},model:{value:e.form.provinceId,callback:function(t){e.$set(e.form,"provinceId",t)},expression:"form.provinceId"}},e._l(e.provinceArr,function(e){return a("el-option",{key:e.areaNo,attrs:{label:e.areaName,value:e.areaNo}})})),e._v(" "),a("el-select",{staticStyle:{width:"45%"},attrs:{size:"mini",placeholder:"选择市"},model:{value:e.form.cityId,callback:function(t){e.$set(e.form,"cityId",t)},expression:"form.cityId"}},e._l(e.cityArr,function(e){return a("el-option",{key:e.areaNo,attrs:{label:e.areaName,value:e.areaNo}})}))],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.innerMemDia=!1,e.form={},e.$refs.form.resetFields()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.createInner}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择会员身份",visible:e.identityDia,width:"30%",center:""},on:{"update:visible":function(t){e.identityDia=t}}},[a("div",{staticClass:"text-center"},[a("el-radio",{attrs:{label:"1001"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("普通会员")]),e._v(" "),a("el-radio",{attrs:{label:"1002"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("认证会员(带V身份标识）")])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"light_btn",on:{click:function(t){e.identityDia=!1,e.form={sex:1,rankCode:"1001"}}}},[e._v("取 消")]),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{type:"primary"},on:{click:e.changeIdentity}},[e._v("确 定")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"修改用户权限",visible:e.powerDia,width:"30%",center:""},on:{"update:visible":function(t){e.powerDia=t}}},[a("div",[a("el-checkbox-group",{attrs:{id:"checkList"},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.checkOp,function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.prohibitCode}},[e._v(e._s(t.prohibitName))])}))],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"light_btn",on:{click:function(t){e.powerDia=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{staticClass:"light_btn",attrs:{type:"primary"},on:{click:e.changePower}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var r=a("VU/8")(i,o,!1,function(e){a("OEpR")},null,null);t.default=r.exports}});
//# sourceMappingURL=43.85c1566da302f03a20bf.js.map