webpackJsonp([19],{"oPi+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("TIfe"),s=(a("RRt9"),{components:{},data:function(){return{currentPage:1,per_page:10,total_pages:1,tableData:[],activeName:"first",uploadVideoing1:!1,uploadVideoing2:!1,formDatas:"",accounts:[],fileList:[],fileListVideo:[],showDia:!1,form2:"",pkg:"",uploadData:{},baceUrl:"",dialogImageUrl:"",dialogVisible:!1,form1:{title:"",content:"",columnId:"",author:"",userId:"",imgType:"0",newsFile:"",tagLabels:"",keyWords:""},idDetail:"",cities:[],showUrl:"",argu:{},videoUrl:"",columnIds:"",videoId:"",rules1:{title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:1,max:50,message:"长度在 50字以内",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{min:1,max:500,message:"长度在 500字以内",trigger:"blur"}],columnId:[{required:!0,message:"请选择来源",trigger:"change"}],userId:[{required:!0,message:"请选择发布账号",trigger:"change"}],tagLabels:[{validator:function(e,t,a){""===t?a():(console.log(t),t.replace(/，/gi,",").split(",").map(function(e){e.replace(/[^\x00-\xff]/g,"aa").length>12?a(new Error("单个tag标签不能超过12字节!")):a()}))},trigger:"blur"}]}}},created:function(){var e=this;this.baceUrl=Object(o.a)(),this.videoUrl=this.baceUrl+"/news/addVideo",this.$get("/videoColumn/findColumnList",{tokenId:this.$store.state.user.tokenId,enabled:""}).then(function(t){e.columnIds=t.data}),this.argu=this.$route.params.argu,this.getParams()},mounted:function(){var e=this;this.$get("reprintSth/findAll",{tokenId:this.$store.state.user.tokenId}).then(function(t){e.cities=t.data}),this.$post("members/findByLevel",{tokenId:this.$store.state.user.tokenId,levelCode:100002}).then(function(t){e.accounts=t.data}),this.showNews(),this.getComment()},methods:{handleClose:function(e){document.getElementById("myVideo").pause(),e()},getParams:function(){this.idDetail=this.$route.params.id},delCom:function(e){var t=this;this.$confirm("确定要删除这条评论吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$post("/comment/delete",{tokenId:t.$store.state.user.tokenId,id:e.id}).then(function(e){0==e.code&&t.$message({type:"success",message:"删除成功!"}),t.getComment()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},getComment:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,linkId:this.idDetail,limit:this.per_page,offset:this.currentPage};this.$post("/comment/importList",t).then(function(t){0==t.code&&(e.tableData=t.data[0].rows,e.total_pages=t.data[0].total)})},showNews:function(){var e=this,t={tokenId:this.$store.state.user.tokenId,id:this.idDetail};this.$get("video/show",t).then(function(t){e.form1=t.data[0],e.accounts.map(function(t){if(t.userId==e.form1.userId)return console.log(t.nickName),void(e.form1.author=t.nickName)}),e.videoId=e.form1.videoId,e.showUrl=e.form1.videoUrl,e.fileListVideo.push({name:e.form1.videoName,url:e.form1.videoUrl})})},showPre:function(){var e=this;this.$refs.form1.validate(function(t){t&&(e.showDia=!0)})},getUContent:function(){var e=this.$refs.ueditor.getUEContent();console.log(e),this.form1.content=e},beforeUpload:function(e){console.log(e)},uploadVideo:function(e){var t=this,a=new FormData;a.append("newsVideo",e.file),this.uploadVideoing1=!0,this.uploadVideoing2=!0,this.$post("/news/addVideo",a).then(function(e){0==e.code?(t.uploadVideoing1=!1,t.showUrl=e.data[1],t.videoId=e.data[0],t.$refs.videoVali.clearValidate(),t.$message({message:e.msg,type:"success"})):(t.$message({message:e.msg?e.msg:"操作失败",type:"error"}),t.uploadVideoing1=!1,t.uploadVideoing2=!1)})},exceedFile:function(){this.$message.warning("只能上传一个视频!")},uploading:function(e,t,a){},videoChange:function(e,t){console.log(e,t);var a=new FormData;a.append("file",e,e.name),this.$post("images/upload",a).then(function(e){console.log(e)})},submitUpload:function(){console.log(this.fileListVideo),this.$refs.uploadVideo1.submit()},handleRemove2:function(e,t){this.showUrl="",this.videoId="",this.uploadVideoing2=!1,this.$message({message:"请重新选择视频",type:"info"})},handleSuccess:function(e,t){console.log(t)},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},getFullUrl:function(){return this.baceUrl+"/news/add"},creatVideo:function(e,t){var a=this;this.$refs[e].validate(function(e){if(console.log(e),e){a.formDatas=new FormData,a.formDatas.append("tokenId",a.$store.state.user.tokenId),a.formDatas.append("id",a.form1.id),a.formDatas.append("title",a.form1.title),a.formDatas.append("content",a.form1.content),a.formDatas.append("userId",a.form1.userId),a.formDatas.append("columnId",a.form1.columnId),a.formDatas.append("tagLabels",a.form1.tagLabels.replace(/，/gi,",")),a.formDatas.append("publishSource","1"),a.formDatas.append("status",t),a.formDatas.append("videoId",a.videoId);var o=a.$loading({lock:!0,text:"上传中...",target:document.querySelector(".loadingArea"),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});a.$post("/video/edit",a.formDatas).then(function(e){console.log(e),0==e.code?(o.close(),a.$message({message:e.msg,type:"success"}),setTimeout(function(){a.$router.push({name:"video",params:{argu:a.argu}})},1e3)):a.$message({message:e.msg?e.msg:"发布失败",type:"error"})})}})},handleExceed:function(e,t){this.$message.warning("当前限制上传 "+this.form1.coverNum+"个文件")},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},fanhui:function(){var e=this;this.$confirm("返回已编辑内容将重置是否继续？").then(function(t){e.$router.push({name:"video",params:{argu:e.argu}}),done()}).catch(function(e){})},handleSizeChange:function(e){this.per_page=e,this.getComment()},handleCurrentChange:function(e){this.currentPage=e,this.getComment()}},beforeRouteLeave:function(e,t,a){e.meta.keepAlive=!0,a()},watch:{$route:"getParams"}}),i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"page-body news-add",staticStyle:{"min-width":"980px"}},[o("el-dialog",{attrs:{center:"",width:"375px",visible:e.showDia,"append-to-body":"","before-close":e.handleClose},on:{"update:visible":function(t){e.showDia=t}}},[o("el-form",{ref:"form2",staticClass:"form1 u_editor",attrs:{data:e.form2,"label-width":"110px"}},[o("video",{staticStyle:{background:"rgba(0,0,0,0.7)"},attrs:{src:e.form1.videoUrl,id:"myVideo",width:"100%",height:"240",controls:""}},[o("source",{attrs:{src:e.form1.videoUrl,type:"video/mp4"}})]),e._v(" "),o("p",{staticClass:"marT20",staticStyle:{height:"20px","line-height":"20px","font-size":"16px"}},[o("img",{staticStyle:{width:"20px",height:"20px","border-radius":"50%",display:"block",float:"left","margin-right":"10px"},attrs:{src:a("iEXv"),alt:""}}),o("span",[e._v(e._s(e.form1.author))])]),e._v(" "),o("p",{staticClass:"title marT20"},[e._v(e._s(e.form1.title))]),e._v(" "),o("p",{staticClass:"color9"},[e._v(e._s(e.form1.updateTime))]),e._v(" "),o("p",{staticClass:"content",domProps:{innerHTML:e._s(e.form1.content)}})])],1),e._v(" "),o("div",{staticClass:"breadcrumb",staticStyle:{padding:"8px"}},[o("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("内容中心")]),e._v(" "),o("el-breadcrumb-item",[e._v("发布内容")]),e._v(" "),o("el-breadcrumb-item",[e._v("编辑视频")])],1)],1),e._v(" "),o("div",{staticClass:"box"},[o("div",{staticClass:"text-right marR100"},[o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:e.fanhui}},[e._v("返回")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:e.showPre}},[e._v("预览")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.creatVideo("form1",0)}}},[e._v("仅保存")]),e._v(" "),o("el-button",{staticClass:"light_btn",attrs:{size:"small"},on:{click:function(t){e.creatVideo("form1","1")}}},[e._v("保存并提交审核")])],1),e._v(" "),o("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[o("el-form",{ref:"form1",staticClass:"up_form clearfix",attrs:{model:e.form1,"label-width":"96px",rules:e.rules1}},[o("div",{staticStyle:{width:"48%",float:"left",padding:"15px","margin-left":"2%","margin-right":"5%"}},[o("el-form-item",{attrs:{label:"视频标题",prop:"title"}},[o("el-input",{staticStyle:{width:"420px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入标题"},model:{value:e.form1.title,callback:function(t){e.$set(e.form1,"title",t)},expression:"form1.title"}})],1),e._v(" "),o("el-form-item",{staticClass:"editor",attrs:{label:"视频简介",prop:"content"}},[o("el-input",{staticStyle:{width:"420px"},attrs:{type:"textarea",rows:6},model:{value:e.form1.content,callback:function(t){e.$set(e.form1,"content",t)},expression:"form1.content"}})],1),e._v(" "),o("el-form-item",{ref:"videoVali",attrs:{label:"上传视频:",prop:"videoVali"}},[o("el-upload",{ref:"uploadVideo1",staticClass:"upload-demo",attrs:{limit:1,name:"newsVideo",action:"",accept:"video/mp4","on-remove":e.handleRemove2,"before-upload":e.beforeUpload,"http-request":e.uploadVideo,"on-progress":e.uploading,"file-list":e.fileListVideo,"on-success":e.handleSuccess,"on-exceed":e.exceedFile,"before-remove":e.beforeRemove,"auto-upload":!1}},[o("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取视频")]),e._v(" "),o("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success",loading:e.uploadVideoing1,disabled:e.uploadVideoing2},on:{click:e.submitUpload}},[e._v("点击上传视频")]),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请选择mp4文件进行上传")])],1)],1),e._v(" "),e.videoId?o("el-form-item",{attrs:{label:"视频预览:"}},[o("video",{staticStyle:{background:"rgba(0,0,0,0.7)"},attrs:{width:"320",height:"240",controls:""}},[o("source",{attrs:{src:e.showUrl,type:"video/mp4"}})])]):e._e()],1),e._v(" "),o("div",{staticStyle:{width:"35%",float:"left",padding:"15px","min-width":"420px"}},[o("el-form-item",{attrs:{label:"发布到:",prop:"columnId"}},[o("el-select",{attrs:{filterable:"",name:"columnId",placeholder:"请选择"},model:{value:e.form1.columnId,callback:function(t){e.$set(e.form1,"columnId",t)},expression:"form1.columnId"}},e._l(e.columnIds,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),o("el-form-item",{staticClass:"fabuStyle",attrs:{label:"发布账号:",prop:"userId"}},[o("el-select",{attrs:{disabled:"",filterable:"",placeholder:"请选择发布账号"},model:{value:e.form1.userId,callback:function(t){e.$set(e.form1,"userId",t)},expression:"form1.userId"}},e._l(e.accounts,function(e){return o("el-option",{key:e.userId,attrs:{label:e.nickName,value:e.userId}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"Tag标签:",prop:"tagLabels"}},[o("el-input",{attrs:{placeholder:"用'，'隔开，单个标签小于12字节"},model:{value:e.form1.tagLabels,callback:function(t){e.$set(e.form1,"tagLabels",t)},expression:"form1.tagLabels"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"视频ID:"}},[o("el-input",{attrs:{disabled:""},model:{value:e.form1.articleId,callback:function(t){e.$set(e.form1,"articleId",t)},expression:"form1.articleId"}})],1)],1)])],1),e._v(" "),o("el-tab-pane",{attrs:{label:"系统信息",name:"second"}},[o("div",{staticClass:"tableOverstyle",staticStyle:{width:"1000px",margin:"auto"}},[o("el-table",{staticClass:"marT20",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[o("el-table-column",{attrs:{label:"序号",type:"index",align:"center",width:"50"}}),e._v(" "),o("el-table-column",{attrs:{prop:"content",label:"评论内容"}}),e._v(" "),o("el-table-column",{attrs:{prop:"nick_name",label:"账号"}}),e._v(" "),o("el-table-column",{attrs:{prop:"create_time",label:"评论时间"}}),e._v(" "),o("el-table-column",{attrs:{prop:"date",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{staticClass:"marR10",attrs:{type:"text"},on:{click:function(a){e.delCom(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),o("el-pagination",{staticClass:"text-right marT20",attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":this.per_page,layout:"total, sizes, prev, pager, next, jumper",total:this.total_pages},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)])],1)],1)],1)},staticRenderFns:[]};var r=a("VU/8")(s,i,!1,function(e){a("s9zv")},null,null);t.default=r.exports},s9zv:function(e,t){}});
//# sourceMappingURL=19.1afd92c84f42700d9232.js.map